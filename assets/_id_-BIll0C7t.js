import{_ as lt}from"./AppTextField-jGANKBQX.js";import{al as nt,aL as it,u as ct,bd as rt,r as C,bc as Ae,O as v,E as ut,f as z,e as t,o as p,b as e,d as n,k as b,c as h,t as l,l as i,s as m,a9 as d,a2 as g,F as ie,h as ce,p as dt,aF as re,v as Se}from"./index-Df0vDIYO.js";import{u as mt}from"./authStore-DUaivpLC.js";import{u as pt}from"./globalStore-BpBUMNSr.js";import{$ as q}from"./api-BZDa_H6V.js";import{_ as ft}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as vt}from"./VContainer-CkDeoApE.js";import{V as j,a as T}from"./VRow-C48oP8rF.js";import{V as k,b as U,d as H}from"./VCard-CgfAP4z1.js";import{V as A}from"./VCardText-CB6nWipv.js";import{V}from"./VChip-LN2DMLlg.js";import{V as Q}from"./VSheet-9kb09pNt.js";import{V as Oe}from"./VAvatar-BSK7_YRS.js";import{V as N}from"./VSpacer-OQhTJPOQ.js";import{V as _t}from"./VTooltip-C32-EOfz.js";import{V as ht}from"./VTable-DtUBh9GH.js";import{V as Re}from"./VForm-LJs8z4wK.js";import{V as bt}from"./VTextField-Bk-xicTH.js";import{V as gt}from"./VDivider-CvbwvjDI.js";import{V as xt}from"./VTextarea-DfgXeJQ-.js";import{V as X}from"./VDialog-CsbQggch.js";import{V as Ne,a as Fe}from"./VToolbar-Bqo_mXVK.js";import{V as wt}from"./VImg-D-iRAKzb.js";import{V as yt}from"./VSnackbar-U_R2qOlN.js";import"./VLabel-X6aAEUPa.js";import"./useApi-CrpjD065.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VSlideGroup-Dk-H89GK.js";import"./VOverlay-CEc4fXoL.js";import"./easing-Bybner-F.js";import"./delay-FQ7L2EsZ.js";import"./lazy-B5EM0j6M.js";import"./scopeId-DhzGCC8_.js";import"./forwardRefs-C-GTDzx5.js";import"./form-CH_H7Z9j.js";/* empty css                   */import"./VCounter-CDNaFmaS.js";import"./VField-uLTC6ZdN.js";import"./VInput-DH7V_F8-.js";import"./dialog-transition-Nz-Hs-46.js";const kt={class:"sidebar-stack"},Vt={class:"status-section mb-6"},Ct={class:"text-caption text-medium-emphasis mb-2"},zt={class:"info-section mb-6"},Tt={class:"text-caption text-medium-emphasis mb-2"},At={class:"info-item d-flex align-center mb-2"},St={class:"text-body-2"},Ot={class:"info-item d-flex align-center mb-2"},Rt={class:"text-body-2"},Nt={class:"info-item d-flex align-center mb-2"},Ft={class:"info-item d-flex align-center"},jt={key:0,class:"offer-price-compact mt-4"},Ut={class:"text-caption text-medium-emphasis mb-2"},Pt={class:"d-flex align-center gap-2"},$t={class:"text-subtitle-1 font-weight-bold"},Et={key:1,class:"consultant-section mt-6"},It={class:"text-caption text-medium-emphasis mb-2"},Lt={class:"d-flex align-center"},Dt={class:"avatar-initials"},Mt={class:"min-w-0"},Bt={class:"text-body-1 font-weight-600 text-truncate"},qt={class:"text-caption text-medium-emphasis text-truncate"},Ht={class:"text-h6"},Gt={class:"contact-method-display"},Kt={class:"contact-details"},Zt={key:0,class:"detail-item d-flex align-center mb-2"},Jt={key:1,class:"detail-item d-flex align-center mb-2"},Wt={key:2,class:"detail-item"},Qt={key:3,class:"detail-item"},Xt={class:"text-h4 font-weight-bold mb-2 primary--text"},Yt={class:"d-flex align-center flex-wrap gap-2 mb-3"},eo={class:"text-body-1 text-medium-emphasis mb-0"},to={class:"d-flex flex-wrap gap-2 justify-end"},oo={class:"text-caption text-medium-emphasis mt-2"},ao={class:"text-h6"},so={key:0,class:"attachments-grid"},lo={key:0,class:"attachment-preview"},no=["src","alt"],io={key:1,class:"attachment-preview file-icon-preview"},co={class:"text-caption text-medium-emphasis mt-2"},ro={key:1,class:"text-center py-8"},uo={class:"text-body-1 text-medium-emphasis"},mo={class:"d-flex align-center justify-space-between flex-wrap"},po={class:"d-flex align-center"},fo={class:"text-caption text-medium-emphasis mb-1"},vo={class:"text-h5 font-weight-bold"},_o={class:"text-right mt-3 mt-md-0"},ho={class:"text-subtitle-1 font-weight-bold mb-3"},bo={class:"text-medium-emphasis font-weight-600"},go={class:"text-right font-weight-bold"},xo={class:"text-medium-emphasis font-weight-600"},wo={class:"text-right font-weight-bold"},yo={class:"text-medium-emphasis font-weight-600"},ko={class:"text-right"},Vo={class:"d-flex align-center mt-3 text-caption text-medium-emphasis"},Co={class:"mt-4"},zo={class:"d-flex align-center justify-space-between flex-wrap"},To={class:"text-caption text-medium-emphasis mb-1"},Ao={key:0,class:"text-body-2 text-medium-emphasis"},So={class:"text-h6"},Oo={key:0,class:"contact-selection"},Ro={class:"d-flex align-center gap-2"},No={class:"text-subtitle-1 section-title"},Fo={class:"mx-auto icon-pill"},jo={class:"text-h6 mt-2 fw-600"},Uo={class:"details-title d-flex align-center gap-2"},Po={class:"text-h6"},$o={key:0,class:"text-body-2 whitespace-pre-wrap"},Eo={key:1,class:"text-body-2 text-medium-emphasis"},Io={key:2,class:"mt-6"},Lo={class:"text-caption text-medium-emphasis mb-2"},Do={class:"attachments-grid"},Mo={key:0,class:"attachment-preview"},Bo=["src","alt"],qo={key:1,class:"attachment-preview file-icon-preview"},Ho={class:"text-caption text-medium-emphasis mt-2"},je=.15,Go={__name:"[id]",setup(Ko){const{t:s}=nt(),P=it(),$=ct().params.id,Ue=pt(),Pe=`/v1/consultations/${$}`,$e=`/v1/consultations/${$}/offer`,Ee=`/v1/consultations/${$}/accept`,Ie=`/v1/consultations/${$}/reject`,Le=`/v1/consultations/${$}/response`;mt(),rt();const ue=C(!0),F=C(!1),G=C(!1),K=C(!1),E=C(!1),I=C(!1),De=C(""),L=C(!1),x=C(!1),w=C(""),y=C("success"),r=Ae({id:null,consultation_number:"",subject:"",description:"",attachments:[],status:null,activity:null,type:null,date:null,oppointment_method:null,oppointment_url:null,oppointment_date:null,oppointment_time:null,price:null,notes:null,handledby:null,consultant_response:null,consultant_response_attachment:[]}),u=Ae({price:"",notes:"",consultant_response:"",oppointment_method:null,oppointment_date:null,oppointment_time:null,oppointment_url:""}),Z=v(()=>Ue.currentLanguage||"en"),Y=(o,a)=>{const _=a||Z.value;return o==null?s("common.na"):typeof o=="string"?o:o[_]??o.en??o.ar??s("common.na")},Me=o=>{const a=typeof o=="object"?(o==null?void 0:o.en)||(o==null?void 0:o.ar)||"":o||"";return String(a).trim().toLowerCase()},O=o=>{const a=String(o||"").toLowerCase();return a==="chat"?{icon:"tabler-message-circle",color:"info",label:s("consultations.view.methods.chat")}:a==="session"?{icon:"tabler-video",color:"success",label:s("consultations.view.methods.session")}:{icon:"tabler-circle-dashed",color:"secondary",label:s("common.na")}},de=o=>{const a=String(o||"").toLowerCase();return a.includes("pending")?"warning":a.includes("closed")?"success":a.includes("new")?"info":a.includes("archived")?"secondary":a.includes("draft")?"info":"primary"},me=v(()=>{var o;return Y((o=r.status)==null?void 0:o.title)}),pe=v(()=>{var o;return Y((o=r.activity)==null?void 0:o.name)}),fe=v(()=>{var o;return Y((o=r.type)==null?void 0:o.name)}),ve=v(()=>{var o;return Me((o=r.status)==null?void 0:o.title)}),ee=v(()=>Array.isArray(r.attachments)?r.attachments.length:0),Be=v(()=>r.oppointment_method&&r.oppointment_method!=="none"),qe=v(()=>!r.oppointment_method||r.oppointment_method==="none"),He=v(()=>{var o;return((o=r.status)==null?void 0:o.id)===2}),J=v(()=>{var o;return((o=r.status)==null?void 0:o.id)===4}),te=v(()=>{var o;return((o=r.status)==null?void 0:o.id)===3}),_e=v(()=>{var o;return((o=r.status)==null?void 0:o.id)===5}),he=v(()=>r.payment_status=="paid"),be=v(()=>te.value&&P.can("accept","offer")),ge=v(()=>te.value&&P.can("reject","offer"));function oe(o){const a=Number(o);if(Number.isNaN(a))return"";const _=Z.value==="ar"?"ar-SA":"en-SA";try{return new Intl.NumberFormat(_,{style:"currency",currency:"SAR",maximumFractionDigits:2}).format(a)}catch{const c=a.toFixed(2);return Z.value==="ar"?`${c} ر.س`:`SAR ${c}`}}const R=v(()=>{const o=r.price??u.price;return o===""||o===null||o===void 0?null:Number(o)}),Ge=v(()=>R.value!==null?oe(R.value):null),ae=v(()=>Array.isArray(r.consultant_response_attachment)?r.consultant_response_attachment:[]),xe=v(()=>!!r.consultant_response||ae.value.length>0),we=C([{key:"chat",title:{en:"Instant Chat",ar:"محادثة فورية"},desc:{en:"Instant text chat with the consultant through the platform",ar:"محادثة نصية فورية مع المستشار عبر المنصة"},icon:"tabler-message-circle",className:"soft-chat"},{key:"session",title:{en:"Video Call",ar:"مكالمة فيديو"},desc:{en:"Live video session via Zoom with screen sharing",ar:"جلسة فيديو مباشرة عبر Zoom مع مشاركة الشاشة"},icon:"tabler-video",className:"soft-video"}]);function Ke(o){u.oppointment_method=o,u.oppointment_date=null,u.oppointment_time=null,o!=="session"&&(u.oppointment_url="")}const Ze=[o=>!!o||s("consultations.view.validation.priceRequired"),o=>!isNaN(o)&&Number(o)>0||s("consultations.view.validation.priceValid")],D=C(!1),se=C(null);function Je(o){se.value=o,D.value=!0}function W(o){try{return new URL(o,window.location.origin).pathname.split(".").pop().toLowerCase()||"file"}catch{return"file"}}function We(o){try{const _=new URL(o,window.location.origin).pathname.split("/").pop()||"file";try{return decodeURIComponent(_)}catch{return _}}catch{return"file"}}function le(o){return["jpg","jpeg","png","gif","bmp","webp","svg"].includes(W(o))}function ye(o){const a=W(o),_={pdf:"mdi-file-pdf-box",doc:"mdi-file-word",docx:"mdi-file-word",txt:"mdi-file-document-outline",xls:"mdi-file-excel",xlsx:"mdi-file-excel",csv:"mdi-file-delimited",ppt:"mdi-file-powerpoint",pptx:"mdi-file-powerpoint",zip:"mdi-folder-zip",rar:"mdi-folder-zip","7z":"mdi-folder-zip",mp4:"mdi-file-video",avi:"mdi-file-video",mov:"mdi-file-video",mp3:"mdi-file-music",wav:"mdi-file-music",default:"mdi-file"};return _[a]||_.default}function ke(o){const a=W(o),_={pdf:"red",doc:"blue",docx:"blue",xls:"green",xlsx:"green",ppt:"orange",pptx:"orange",zip:"purple",rar:"purple","7z":"purple",txt:"grey",mp4:"pink",mp3:"purple",default:"grey"};return _[a]||_.default}function Ve(o){le(o)?Je(o):window.open(o,"_blank")}function Qe(o){const a=document.createElement("a");a.href=o,a.download=o.split("/").pop(),a.target="_blank",document.body.appendChild(a),a.click(),document.body.removeChild(a)}function Ce(o){const a=o.target;a.classList.add("image-error"),a.alt=s("consultations.view.attachments.imageLoadFailed")}function Xe(o){const a=String(o).split(" ").filter(Boolean);if(!a.length)return"C";const _=a[0][0]||"",c=a[1]&&a[1][0]||"";return(_+c).toUpperCase()}async function M(){ue.value=!0;try{const o=await q(Pe,{method:"GET"});Object.assign(r,(o==null?void 0:o.data)||{}),r.price!==null&&r.consultant_response&&(u.consultant_response=r.consultant_response)}catch(o){console.error(o),w.value=s("consultations.view.messages.loadFailed"),y.value="error",x.value=!0}finally{ue.value=!1}}async function Ye(){var o,a,_,c;if(!u.price||isNaN(u.price)||Number(u.price)<=0){w.value=s("consultations.view.messages.enterValidPrice"),y.value="error",x.value=!0;return}if(u.oppointment_method){if(!u.oppointment_date){w.value=s("consultations.view.messages.appointmentDateRequired"),y.value="error",x.value=!0;return}if(!u.oppointment_time){w.value=s("consultations.view.messages.appointmentTimeRequired"),y.value="error",x.value=!0;return}if(u.oppointment_method==="session"&&!((o=u.oppointment_url)!=null&&o.trim())){w.value=s("consultations.view.messages.sessionUrlRequired"),y.value="error",x.value=!0;return}}F.value=!0;try{const f={price:Number(u.price),notes:((a=u.notes)==null?void 0:a.trim())||null};(_=u.consultant_response)!=null&&_.trim()&&(f.consultant_response=u.consultant_response.trim()),u.oppointment_method&&(f.oppointment_method=u.oppointment_method,f.oppointment_date=u.oppointment_date,f.oppointment_time=u.oppointment_time,u.oppointment_method==="session"&&((c=u.oppointment_url)!=null&&c.trim())&&(f.oppointment_url=u.oppointment_url.trim())),await q($e,{method:"PUT",body:f}),w.value=s("consultations.view.messages.offerSubmitted"),y.value="success",x.value=!0,await M()}catch(f){console.error(f),w.value=(f==null?void 0:f.message)||s("consultations.view.messages.offerSubmitFailed"),y.value="error",x.value=!0}finally{F.value=!1}}async function et(){var o;if(!((o=u.consultant_response)!=null&&o.trim())){w.value=s("consultations.view.messages.enterConsultationResponse"),y.value="error",x.value=!0;return}F.value=!0;try{const a={consultant_response:u.consultant_response.trim()};await q(Le,{method:"PUT",body:a}),w.value=s("consultations.view.messages.responseUpdated"),y.value="success",x.value=!0,await M()}catch(a){console.error(a),w.value=(a==null?void 0:a.message)||s("consultations.view.messages.responseUpdateFailed"),y.value="error",x.value=!0}finally{F.value=!1}}async function tt(){G.value=!0;try{await q(Ee,{method:"POST"}),w.value=s("consultations.view.messages.offerAccepted"),y.value="success",x.value=!0,E.value=!1,await M()}catch(o){console.error(o),w.value=(o==null?void 0:o.message)||s("consultations.view.messages.acceptFailed"),y.value="error",x.value=!0}finally{G.value=!1}}async function ot(){K.value=!0;try{await q(Ie,{method:"POST"}),w.value=s("consultations.view.messages.offerRejected"),y.value="success",x.value=!0,I.value=!1,De.value="",await M()}catch(o){console.error(o),w.value=(o==null?void 0:o.message)||s("consultations.view.messages.rejectFailed"),y.value="error",x.value=!0}finally{K.value=!1}}const ze=v(()=>R.value?R.value*je:0),at=v(()=>R.value?R.value+ze.value:0),st=v(()=>oe(ze.value)),B=v(()=>oe(at.value));return ut(M),(o,a)=>{const _=lt;return p(),z(vt,{fluid:"",class:"consultation-container"},{default:t(()=>[e(j,null,{default:t(()=>[e(T,{cols:"12",md:"3",class:"sidebar"},{default:t(()=>[n("div",kt,[e(k,{class:"sidebar-card",elevation:"2",rounded:"lg"},{default:t(()=>[e(A,{class:"pa-4"},{default:t(()=>[n("div",Vt,[n("div",Ct,l(i(s)("consultations.view.sidebar.statusTitle")),1),e(V,{color:de(ve.value),size:"small",label:"",class:"text-capitalize"},{default:t(()=>[e(d,{icon:"tabler-flag-3",class:"me-1"}),m(" "+l(me.value),1)]),_:1},8,["color"])]),n("div",zt,[n("div",Tt,l(i(s)("consultations.view.sidebar.infoTitle")),1),n("div",At,[e(d,{icon:"tabler-hash",size:"18",class:"me-2 text-medium-emphasis"}),n("span",St,l(r.consultation_number||i(s)("common.na")),1)]),n("div",Ot,[e(d,{icon:"tabler-calendar",size:"18",class:"me-2 text-medium-emphasis"}),n("span",Rt,l(r.date||i(s)("common.na")),1)]),n("div",Nt,[e(V,{size:"x-small",variant:"tonal",color:"primary",label:""},{default:t(()=>[e(d,{icon:"tabler-briefcase",class:"me-1"}),m(" "+l(pe.value),1)]),_:1})]),n("div",Ft,[e(V,{size:"x-small",variant:"tonal",color:"secondary",label:""},{default:t(()=>[e(d,{icon:"tabler-tag",class:"me-1"}),m(" "+l(fe.value),1)]),_:1})])]),R.value!==null?(p(),h("div",jt,[n("div",Ut,l(i(s)("consultations.view.sidebar.offerPriceTitle")),1),e(Q,{class:"d-flex align-center justify-space-between pa-3 rounded-lg price-chip",border:""},{default:t(()=>[n("div",Pt,[e(d,{icon:"mdi-currency-usd",color:"primary"}),n("span",$t,l(B.value),1)]),e(V,{size:"x-small",color:J.value?"success":"primary",variant:"tonal"},{default:t(()=>[m(l(J.value?i(s)("consultations.view.sidebar.accepted"):i(s)("consultations.view.sidebar.proposed")),1)]),_:1},8,["color"])]),_:1})])):b("",!0),r.handledby!=null?(p(),h("div",Et,[n("div",It,l(i(s)("consultations.view.sidebar.consultantTitle")),1),e(Q,{class:"pa-3 rounded-lg",border:""},{default:t(()=>{var c,f,S;return[n("div",Lt,[e(Oe,{size:"44",color:"primary",variant:"tonal",class:"me-3"},{default:t(()=>{var ne,Te;return[n("span",Dt,l(Xe(((ne=r.handledby)==null?void 0:ne.name)||((Te=r.handledby)==null?void 0:Te.username)||"C")),1)]}),_:1}),n("div",Mt,[n("div",Bt,l(((c=r.handledby)==null?void 0:c.name)||i(s)("common.na")),1),n("div",qt,l(((f=r.handledby)==null?void 0:f.email)||((S=r.handledby)==null?void 0:S.username)||i(s)("common.na")),1)])])]}),_:1})])):b("",!0)]),_:1})]),_:1}),Be.value?(p(),z(k,{key:0,class:"contact-card",elevation:"2",rounded:"lg"},{default:t(()=>[e(U,{class:"d-flex align-center"},{default:t(()=>[e(d,{icon:O(r.oppointment_method).icon,class:"me-2",color:O(r.oppointment_method).color},null,8,["icon","color"]),n("span",Ht,l(i(s)("consultations.view.sidebar.contactMethodTitle")),1)]),_:1}),e(A,null,{default:t(()=>[n("div",Gt,[e(V,{color:O(r.oppointment_method).color,size:"small",label:"",class:"text-capitalize mb-3"},{default:t(()=>[e(d,{icon:O(r.oppointment_method).icon,class:"me-1"},null,8,["icon"]),m(" "+l(O(r.oppointment_method).label),1)]),_:1},8,["color"]),n("div",Kt,[r.oppointment_date?(p(),h("div",Zt,[e(V,{size:"x-small",variant:"tonal",color:"primary"},{default:t(()=>[e(d,{icon:"tabler-calendar",class:"me-1"}),m(" "+l(r.oppointment_date),1)]),_:1})])):b("",!0),r.oppointment_time?(p(),h("div",Jt,[e(V,{size:"x-small",variant:"tonal",color:"primary"},{default:t(()=>[e(d,{icon:"tabler-clock",class:"me-1"}),m(" "+l(r.oppointment_time),1)]),_:1})])):b("",!0),r.oppointment_method==="session"&&r.oppointment_url&&_e.value?(p(),h("div",Wt,[e(g,{color:"success",variant:"flat",block:"",size:"small",href:r.oppointment_url},{default:t(()=>[e(d,{icon:"tabler-external-link",class:"me-2"}),m(" "+l(i(s)("consultations.view.sidebar.joinSession")),1)]),_:1},8,["href"])])):r.oppointment_method==="chat"&&he.value?(p(),h("div",Qt,[e(g,{color:"success",variant:"flat",block:"",size:"small",to:{name:"apps-consultations-chat-id",params:{id:r.id}}},{default:t(()=>[e(d,{icon:"tabler-external-link",class:"me-2"}),m(" "+l(i(s)("consultations.view.sidebar.joinChat")),1)]),_:1},8,["to"])])):b("",!0)])])]),_:1})]),_:1})):b("",!0)])]),_:1}),e(T,{cols:"12",md:"9"},{default:t(()=>[e(k,{class:"header-card mb-4",elevation:"2",rounded:"lg"},{default:t(()=>[e(A,{class:"pa-6"},{default:t(()=>[e(j,{align:"center",class:"gy-2"},{default:t(()=>[e(T,{cols:"12",md:"8"},{default:t(()=>[n("h1",Xt,l(r.subject||i(s)("common.na")),1),n("div",Yt,[e(V,{variant:"outlined",size:"small",color:"primary",label:""},{default:t(()=>[e(d,{icon:"tabler-briefcase",class:"me-1"}),m(" "+l(pe.value),1)]),_:1}),e(V,{variant:"outlined",size:"small",color:"secondary",label:""},{default:t(()=>[e(d,{icon:"tabler-tag",class:"me-1"}),m(" "+l(fe.value),1)]),_:1}),e(V,{size:"small",label:"",color:O(r.oppointment_method).label==="—"?"secondary":O(r.oppointment_method).color,class:"text-capitalize"},{default:t(()=>[e(d,{icon:O(r.oppointment_method).icon,class:"me-1"},null,8,["icon"]),m(" "+l(O(r.oppointment_method).label),1)]),_:1},8,["color"]),e(V,{color:de(ve.value),size:"small",label:"",class:"text-capitalize"},{default:t(()=>[e(d,{icon:"tabler-flag-3",class:"me-1"}),m(" "+l(me.value),1)]),_:1},8,["color"])]),n("p",eo,l(r.description||i(s)("common.na")),1)]),_:1}),be.value||ge.value?(p(),z(T,{key:0,cols:"12",md:"4",class:"text-md-end"},{default:t(()=>[n("div",to,[be.value?(p(),z(g,{key:0,color:"success",size:"large",variant:"flat",loading:G.value,onClick:a[0]||(a[0]=c=>E.value=!0)},{default:t(()=>[e(d,{icon:"mdi-check-circle-outline",class:"me-2"}),m(" "+l(i(s)("consultations.view.actions.acceptOffer")),1)]),_:1},8,["loading"])):b("",!0),ge.value?(p(),z(g,{key:1,color:"error",size:"large",variant:"tonal",loading:K.value,onClick:a[1]||(a[1]=c=>I.value=!0)},{default:t(()=>[e(d,{icon:"mdi-close-circle-outline",class:"me-2"}),m(" "+l(i(s)("consultations.view.actions.rejectOffer")),1)]),_:1},8,["loading"])):b("",!0)]),n("div",oo,l(i(s)("consultations.view.actions.respondToProceed")),1)]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1}),e(j,null,{default:t(()=>[e(T,{cols:"12",md:"6"},{default:t(()=>[e(k,{class:"attachments-card",elevation:"2",rounded:"lg"},{default:t(()=>[e(U,{class:"d-flex align-center"},{default:t(()=>[e(V,{size:"small",class:"ms-2 me-2",color:"primary",label:""},{default:t(()=>[e(d,{icon:"tabler-folder"})]),_:1}),n("span",ao,l(i(s)("consultations.view.attachments.title")),1),e(V,{size:"small",class:"ms-2",color:ee.value>0?"primary":"secondary",label:""},{default:t(()=>[m(l(ee.value),1)]),_:1},8,["color"])]),_:1}),e(A,null,{default:t(()=>[ee.value>0?(p(),h("div",so,[(p(!0),h(ie,null,ce(r.attachments,(c,f)=>(p(),z(k,{key:f,class:"attachment-item",variant:"outlined",onClick:S=>Ve(c)},{default:t(()=>[le(c)?(p(),h("div",lo,[n("img",{src:c,alt:i(s)("consultations.view.attachments.attachmentAlt",{n:f+1}),class:"attachment-image",onError:a[2]||(a[2]=S=>Ce(S))},null,40,no)])):(p(),h("div",io,[e(d,{icon:ye(c),color:ke(c),size:"64"},null,8,["icon","color"]),n("div",co,l(W(c).toUpperCase()),1)])),e(H,{class:"pa-2 attachment-actions"},{default:t(()=>[e(N),e(_t,{text:i(s)("consultations.view.attachments.preview"),location:"top"},{activator:t(({props:S})=>[e(g,dt({ref_for:!0},S,{size:"small",variant:"tonal",color:"primary",onClick:re(ne=>Qe(c),["stop"]),class:"action-btn"}),{prepend:t(()=>[e(d,{icon:"tabler-external-link"})]),_:2},1040,["onClick"])]),_:2},1032,["text"])]),_:2},1024)]),_:2},1032,["onClick"]))),128))])):(p(),h("div",ro,[e(d,{icon:"mdi-folder-open-outline",size:"64",class:"text-medium-emphasis mb-2"}),n("div",uo,l(i(s)("consultations.view.attachments.empty")),1)]))]),_:1})]),_:1})]),_:1}),e(T,{cols:"12",md:"6"},{default:t(()=>[R.value!==null?(p(),z(k,{key:0,class:"offer-price-card mb-4",elevation:"2",rounded:"lg"},{default:t(()=>[e(A,{class:"pa-5"},{default:t(()=>[n("div",mo,[n("div",po,[e(Oe,{color:"primary",variant:"tonal",size:"44",class:"mr-3"},{default:t(()=>[e(d,{icon:"mdi-currency-usd"})]),_:1}),n("div",null,[n("div",fo,l(i(s)("consultations.view.offer.currentOffer")),1),n("div",vo,l(B.value),1)])]),n("div",_o,[e(V,{color:J.value||_e.value?"success":"primary",variant:"tonal",class:"font-weight-600"},{default:t(()=>[m(l(he.value?i(s)("consultations.view.offer.paid"):te.value?i(s)("consultations.view.offer.waitingClientApproval"):""),1)]),_:1},8,["color"])])]),e(Q,{class:"mt-4 pa-4",color:"blue-lighten-5",rounded:"lg",elevation:"0"},{default:t(()=>[n("div",ho,l(i(s)("consultations.view.offer.offerDetails")),1),e(ht,{class:"elevation-0 rounded-lg offer-table"},{default:t(()=>[n("tbody",null,[n("tr",null,[n("td",bo,l(i(s)("consultations.view.offer.beforeTax")),1),n("td",go,l(Ge.value),1)]),n("tr",null,[n("td",xo,l(i(s)("consultations.view.offer.tax",{rate:je*100})),1),n("td",wo,l(st.value),1)]),n("tr",null,[n("td",yo,l(i(s)("consultations.view.offer.totalToPay")),1),n("td",ko,[e(V,{color:"primary",variant:"flat",class:"px-4 py-2 font-weight-bold"},{default:t(()=>[m(l(B.value),1)]),_:1})])])])]),_:1}),n("div",Vo,[e(d,{icon:"mdi-information-outline",size:"16",class:"mr-1"}),n("span",null,l(i(s)("consultations.view.offer.totalIncludes")),1)])]),_:1}),n("div",Co,[n("div",zo,[n("div",To,l(i(s)("consultations.view.offer.consultantResponseTitle")),1),xe.value?(p(),z(g,{key:0,size:"small",variant:"tonal",color:"primary",onClick:a[3]||(a[3]=c=>L.value=!0)},{default:t(()=>[e(d,{icon:"mdi-message-reply-text",class:"me-1"}),m(" "+l(i(s)("consultations.view.offer.viewResponse")),1)]),_:1})):b("",!0)]),!xe.value&&i(P).can("accept","offer")?(p(),h("div",Ao,l(i(s)("consultations.view.offer.consultantResponseHint")),1)):b("",!0)])]),_:1})]),_:1})):b("",!0),i(P).can("write","offer")&&He.value?(p(),z(k,{key:1,class:"offer-card mb-4",elevation:"2",rounded:"lg"},{default:t(()=>[e(U,{class:"d-flex align-center"},{default:t(()=>[e(d,{icon:"mdi-currency-usd",class:"me-2",color:"primary"}),n("span",So,l(i(s)("consultations.view.makeOffer.title")),1)]),_:1}),e(A,null,{default:t(()=>[e(Re,{onSubmit:re(Ye,["prevent"])},{default:t(()=>[e(bt,{modelValue:u.price,"onUpdate:modelValue":a[4]||(a[4]=c=>u.price=c),label:i(s)("consultations.view.makeOffer.priceLabel"),type:"text",prefix:"SAR",required:"",rules:Ze,class:"mb-4"},null,8,["modelValue","label"]),qe.value?(p(),h("div",Oo,[e(j,null,{default:t(()=>[e(T,{cols:"12"},{default:t(()=>[e(Q,{variant:"flat",class:"section-bar bg-grey-lighten-3"},{default:t(()=>[n("div",Ro,[e(d,{icon:"tabler-messages"}),n("span",No,l(i(s)("consultations.view.makeOffer.contactMethodsOptional")),1)])]),_:1})]),_:1}),(p(!0),h(ie,null,ce(we.value,c=>(p(),z(T,{cols:"12",md:"6",key:c.key},{default:t(()=>[e(k,{class:Se(["method-card soft-card",[c.className,{"is-selected":u.oppointment_method===c.key}]]),variant:"outlined",onClick:f=>Ke(c.key)},{default:t(()=>[e(A,{class:"text-center"},{default:t(()=>[n("div",Fo,[e(d,{icon:c.icon,size:"32"},null,8,["icon"])]),n("div",jo,l(c.title[Z.value]),1)]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024))),128))]),_:1}),u.oppointment_method?(p(),z(j,{key:0},{default:t(()=>[e(T,{cols:"12"},{default:t(()=>{var c;return[e(k,{class:Se(["details-card",(c=we.value.find(f=>f.key===u.oppointment_method))==null?void 0:c.className]),variant:"outlined"},{default:t(()=>[e(A,null,{default:t(()=>[n("div",Uo,[e(d,{icon:u.oppointment_method==="session"?"tabler-video":"tabler-message-circle"},null,8,["icon"]),n("span",null,l(u.oppointment_method==="session"?i(s)("consultations.view.makeOffer.videoCall"):i(s)("consultations.view.makeOffer.instantChat")),1)]),e(gt,{class:"my-4"}),e(j,null,{default:t(()=>[e(T,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:u.oppointment_date,"onUpdate:modelValue":a[5]||(a[5]=f=>u.oppointment_date=f),type:"date",label:i(s)("consultations.view.makeOffer.appointmentDate"),"prepend-inner-icon":"tabler-calendar"},null,8,["modelValue","label"])]),_:1}),e(T,{cols:"12",md:"6"},{default:t(()=>[e(_,{modelValue:u.oppointment_time,"onUpdate:modelValue":a[6]||(a[6]=f=>u.oppointment_time=f),type:"time",label:i(s)("consultations.view.makeOffer.time"),"prepend-inner-icon":"tabler-clock"},null,8,["modelValue","label"])]),_:1}),u.oppointment_method==="session"?(p(),z(T,{key:0,cols:"12"},{default:t(()=>[e(_,{modelValue:u.oppointment_url,"onUpdate:modelValue":a[7]||(a[7]=f=>u.oppointment_url=f),label:i(s)("consultations.view.makeOffer.sessionUrl"),placeholder:i(s)("consultations.view.makeOffer.sessionUrlPlaceholder"),"prepend-inner-icon":"tabler-link"},null,8,["modelValue","label","placeholder"])]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1},8,["class"])]}),_:1})]),_:1})):b("",!0)])):b("",!0),e(g,{color:"primary",size:"large",type:"submit",loading:F.value,block:"",class:"mt-5"},{default:t(()=>[e(d,{icon:"mdi-send",class:"me-2"}),m(" "+l(i(s)("consultations.view.makeOffer.sendOffer")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):b("",!0),i(P).can("answer","consultation")&&J.value?(p(),z(k,{key:2,class:"consultation-text-card mb-4",elevation:"2",rounded:"lg"},{default:t(()=>[e(U,{class:"d-flex align-center"},{default:t(()=>[e(d,{icon:"mdi-message-text",class:"me-2",color:"primary"}),n("span",Po,l(i(s)("consultations.view.consultantText.title")),1)]),_:1}),e(A,null,{default:t(()=>[e(Re,{onSubmit:re(et,["prevent"])},{default:t(()=>[e(xt,{modelValue:u.consultant_response,"onUpdate:modelValue":a[8]||(a[8]=c=>u.consultant_response=c),label:i(s)("consultations.view.consultantText.responseLabel"),rows:"5",class:"mb-4","auto-grow":"",placeholder:i(s)("consultations.view.consultantText.responsePlaceholder")},null,8,["modelValue","label","placeholder"]),e(g,{color:"primary",size:"large",type:"submit",loading:F.value,block:""},{default:t(()=>[e(d,{icon:"mdi-content-save",class:"me-2"}),m(" "+l(i(s)("consultations.view.consultantText.sendResponse")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1})):b("",!0)]),_:1})]),_:1})]),_:1})]),_:1}),e(X,{modelValue:L.value,"onUpdate:modelValue":a[12]||(a[12]=c=>L.value=c),"max-width":"900"},{default:t(()=>[e(k,null,{default:t(()=>[e(Ne,{color:"primary",density:"compact"},{default:t(()=>[e(Fe,null,{default:t(()=>[m(l(i(s)("consultations.view.offer.consultantResponseTitle")),1)]),_:1}),e(N),e(g,{icon:"",onClick:a[9]||(a[9]=c=>L.value=!1)},{default:t(()=>[e(d,null,{default:t(()=>a[21]||(a[21]=[m("mdi-close")])),_:1,__:[21]})]),_:1})]),_:1}),e(A,null,{default:t(()=>[r.consultant_response?(p(),h("div",$o,l(r.consultant_response),1)):(p(),h("div",Eo,l(i(s)("consultations.view.offer.consultantResponseHint")),1)),ae.value.length?(p(),h("div",Io,[n("div",Lo,l(i(s)("consultations.view.offer.responseAttachments")),1),n("div",Do,[(p(!0),h(ie,null,ce(ae.value,(c,f)=>(p(),z(k,{key:f,class:"attachment-item",variant:"outlined",onClick:S=>Ve(c)},{default:t(()=>[le(c)?(p(),h("div",Mo,[n("img",{src:c,alt:i(s)("consultations.view.attachments.attachmentAlt",{n:f+1}),class:"attachment-image",onError:a[10]||(a[10]=S=>Ce(S))},null,40,Bo)])):(p(),h("div",qo,[e(d,{icon:ye(c),color:ke(c),size:"64"},null,8,["icon","color"]),n("div",Ho,l(We(c)),1)]))]),_:2},1032,["onClick"]))),128))])])):b("",!0)]),_:1}),e(H,null,{default:t(()=>[e(N),e(g,{onClick:a[11]||(a[11]=c=>L.value=!1)},{default:t(()=>[m(l(i(s)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:D.value,"onUpdate:modelValue":a[15]||(a[15]=c=>D.value=c),"max-width":"800"},{default:t(()=>[e(k,null,{default:t(()=>[e(Ne,{color:"primary",density:"compact"},{default:t(()=>[e(Fe,null,{default:t(()=>[m(l(i(s)("consultations.view.preview.title")),1)]),_:1}),e(N),e(g,{icon:"",onClick:a[13]||(a[13]=c=>D.value=!1)},{default:t(()=>[e(d,null,{default:t(()=>a[22]||(a[22]=[m("mdi-close")])),_:1,__:[22]})]),_:1})]),_:1}),e(wt,{src:se.value,"max-height":"600",contain:""},null,8,["src"]),e(H,null,{default:t(()=>[e(N),e(g,{color:"primary",href:se.value,target:"_blank",download:""},{default:t(()=>[e(d,{icon:"mdi-download",class:"me-2"}),m(" "+l(i(s)("consultations.view.preview.download")),1)]),_:1},8,["href"]),e(g,{onClick:a[14]||(a[14]=c=>D.value=!1)},{default:t(()=>[m(l(i(s)("common.close")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:E.value,"onUpdate:modelValue":a[17]||(a[17]=c=>E.value=c),"max-width":"480"},{default:t(()=>[e(k,null,{default:t(()=>[e(U,{class:"d-flex align-center"},{default:t(()=>[e(d,{icon:"mdi-check-circle-outline",class:"me-2",color:"success"}),m(" "+l(i(s)("consultations.view.confirm.acceptTitle")),1)]),_:1}),e(A,null,{default:t(()=>[m(l(i(s)("consultations.view.confirm.acceptText",{total:B.value})),1)]),_:1}),e(H,null,{default:t(()=>[e(N),e(g,{variant:"text",onClick:a[16]||(a[16]=c=>E.value=!1)},{default:t(()=>[m(l(i(s)("common.cancel")),1)]),_:1}),e(g,{color:"success",loading:G.value,onClick:tt},{default:t(()=>[e(d,{icon:"mdi-check",class:"me-2"}),m(" "+l(i(s)("consultations.view.actions.accept")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(X,{modelValue:I.value,"onUpdate:modelValue":a[19]||(a[19]=c=>I.value=c),"max-width":"520"},{default:t(()=>[e(k,null,{default:t(()=>[e(U,{class:"d-flex align-center"},{default:t(()=>[e(d,{icon:"mdi-close-circle-outline",class:"me-2",color:"error"}),m(" "+l(i(s)("consultations.view.confirm.rejectTitle")),1)]),_:1}),e(A,null,{default:t(()=>[m(l(i(s)("consultations.view.confirm.rejectText",{total:B.value})),1)]),_:1}),e(H,null,{default:t(()=>[e(N),e(g,{variant:"text",onClick:a[18]||(a[18]=c=>I.value=!1)},{default:t(()=>[m(l(i(s)("common.cancel")),1)]),_:1}),e(g,{color:"error",loading:K.value,onClick:ot},{default:t(()=>[e(d,{icon:"mdi-close",class:"me-2"}),m(" "+l(i(s)("consultations.view.actions.reject")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),e(yt,{modelValue:x.value,"onUpdate:modelValue":a[20]||(a[20]=c=>x.value=c),color:y.value,timeout:"3000"},{default:t(()=>[m(l(w.value),1)]),_:1},8,["modelValue","color"])]),_:1})}}},Pa=ft(Go,[["__scopeId","data-v-a3460552"]]);export{Pa as default};

import{_ as pt}from"./AppTextarea-2wVylbcK.js";import{_ as ct}from"./AppTextField-CLvxn6_C.js";import{u as _t,al as ft,r as p,O as j,bb as vt,w as yt,E as bt,f as _,e as l,o as m,b as o,s as f,t as x,aF as ht,k as X,d as c,a9 as h,c as U,F as I,h as q,v as gt,a2 as z}from"./index-BxU12KgC.js";import{u as Vt}from"./globalStore-Cx9PY_7X.js";import{n as Y,f as kt}from"./images-DNnnEzYI.js";import{$ as tt}from"./api-Ba7n58ZI.js";import{_ as xt}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as v,a as d}from"./VRow--HD-L7TS.js";import{V as M}from"./VCard-CslEgE47.js";import{V as wt}from"./VSnackbar-B_Z8K1Tu.js";import{V as O}from"./VCardText-CTVtF3nt.js";import{V as Ct}from"./VSkeletonLoader-XnpXsnMN.js";import{V as At}from"./VForm-BT--ttCz.js";import{V as et}from"./VSheet-CEKxmovY.js";import{V as ot}from"./VSelect-D5LpZJEo.js";import{V as St}from"./VDivider-Br-SdFzS.js";import{V as nt}from"./form-BXvCDZ_7.js";import{V as lt}from"./VChip-Co1dQI_y.js";import{V as Ut}from"./VFileInput-rSMX_oTq.js";import"./VTextarea-GAQjG-gl.js";/* empty css                   */import"./VCounter-DG6qVdKp.js";import"./VImg-BWtlGard.js";import"./VField-mQ2GfzOK.js";import"./easing-Bybner-F.js";import"./VInput-DkirN1Ab.js";import"./forwardRefs-C-GTDzx5.js";import"./VTextField-D5CDNjP_.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-BhdHmQHY.js";import"./VOverlay-CaKMC9uw.js";import"./delay-BHM9Rsm9.js";import"./lazy-DtMngAEq.js";import"./scopeId-Bt4u8XlJ.js";import"./VList-BmPgoNUJ.js";import"./ssrBoot-DxzwGfmA.js";import"./dialog-transition-B1GHZ5Ud.js";import"./VMenu-Cr3GmoFh.js";import"./VCheckboxBtn-CLDgRS1a.js";import"./VSelectionControl-s-29lyWy.js";import"./VSlideGroup-BjhCBlJv.js";const Ft={class:"d-flex align-center gap-2"},Lt={class:"d-flex align-center gap-2"},Tt={class:"mx-auto icon-pill"},jt={class:"text-h6 mt-2 fw-600"},Bt={class:"text-body-2 mt-1 subtle"},Dt={class:"text-center mt-4"},$t={class:"details-title d-flex align-center gap-2"},Nt={key:0,class:"mb-2"},Et={key:1,class:"text-caption mb-2"},It="PUT",qt={__name:"[id]",setup(zt){const P=_t().params.id,w=Vt(),{locale:Ot}=ft({useScope:"global"}),at=`/v1/consultations/${P}`,it=`/v1/consultations/${P}`,y=p(!1),g=p(""),V=p("deep-purple-accent-4"),B=p(!0),k=p(!1),D=p(!1),$=p(!1),C=p([]),A=p([]),N=p([]),R=p(0),st=[{key:"chat",title:"Instant Chat",desc:"Instant text chat with the consultant through the platform",icon:"tabler-message-circle",className:"soft-chat"},{key:"session",title:"Video Call",desc:"Live video session via Zoom with screen sharing",icon:"tabler-video",className:"soft-video"}],E=j(()=>w.currentLanguage),G=(i,e)=>{const a=e||E.value;return i?typeof i=="string"?i:i[a]??i.en??i.ar??"—":"—"},H=j(()=>{const i=w.activities||[],e=E.value;return i.map(a=>({id:a.id,name:G(a.name,e)}))}),Z=j(()=>{const i=w.consultations_types||[],e=E.value;return i.map(a=>({id:a.id,name:G(a.name,e)}))}),t=vt({subject:"",description:"",activity_id:null,type_id:null,oppointment_method:null,oppointment_date:null,oppointment_time:null,oppointment_url:""}),rt=j(()=>{var e,a;if(!((e=t.subject)!=null&&e.trim())||!t.activity_id)return!1;if(!t.oppointment_method||t.oppointment_method==="none")return!0;const i=!!t.oppointment_date&&!!t.oppointment_time;return t.oppointment_method==="chat"?i:t.oppointment_method==="session"?i&&!!((a=t.oppointment_url)!=null&&a.trim()):!0});async function K(){k.value=!0;try{await w.fetchFeedData()}finally{k.value=!1}}function W(i){const e=Array.isArray(i)?i:[];A.value=e.map(a=>typeof a=="string"?{id:null,name:Y(a),url:a}:{id:a.id??null,name:a.name||a.filename||Y(a.url||a.link||""),url:a.url||a.link||null})}async function J(){var i,e;B.value=!0;try{const a=await tt(at,{method:"GET"}),s=(a==null?void 0:a.data)||{};t.subject=s.subject||"",t.description=s.description||"",t.activity_id=((i=s.activity)==null?void 0:i.id)??null,t.type_id=((e=s.type)==null?void 0:e.id)??null,t.oppointment_method=(s.oppointment_method==="none"?null:s.oppointment_method)||null,t.oppointment_date=s.oppointment_date||null,t.oppointment_time=s.oppointment_time||null,t.oppointment_url=s.oppointment_url||"",W(s.attachments)}catch(a){console.error(a),g.value="Failed to load consultation.",V.value="error",y.value=!0}finally{B.value=!1}}function ut(i){t.oppointment_method=i,t.oppointment_date=null,t.oppointment_time=null,i!=="session"&&(t.oppointment_url="")}function dt(i){const e=A.value.splice(i,1)[0];e&&N.value.push(e)}async function mt(i){var F,L,T,S;let e=[];try{e=(F=C.value)!=null&&F.length?await kt(C.value):[]}catch(b){console.error("Error encoding new files",b),e=[]}const a=A.value,s=N.value,n=a.map(b=>b.id??b.url).filter(Boolean),r=s.map(b=>b.id??b.url).filter(Boolean),u={subject:((L=t.subject)==null?void 0:L.trim())||"",description:((T=t.description)==null?void 0:T.trim())||"",activity_id:t.activity_id,status_id:i,attachments_add:e,existing_attachments:n,removed_existing_attachments:r};return t.type_id!=null&&t.type_id!==""&&(u.type_id=t.type_id),u.oppointment_method=t.oppointment_method&&t.oppointment_method!=="none"?t.oppointment_method:"none",(u.oppointment_method==="chat"||u.oppointment_method==="session")&&(u.oppointment_date=t.oppointment_date,u.oppointment_time=t.oppointment_time),u.oppointment_method==="session"&&((S=t.oppointment_url)!=null&&S.trim())&&(u.oppointment_url=t.oppointment_url.trim()),u}async function Q(i){var e,a,s;if(!rt.value){g.value=(e=t.subject)!=null&&e.trim()?t.activity_id?t.oppointment_method&&!t.oppointment_date?"Appointment date is required.":t.oppointment_method&&!t.oppointment_time?"Appointment time is required.":t.oppointment_method==="session"&&!((a=t.oppointment_url)!=null&&a.trim())?"Session URL is required.":"Please check required fields.":"Activity is required.":"Subject is required.",V.value="error",y.value=!0;return}i===1?$.value=!0:D.value=!0;try{const n=await mt(i),r=await tt(it,{method:It,body:n,onResponseError({response:F}){var S;const L=((S=F._data)==null?void 0:S.errors)||{},T=Object.values(L).flat().filter(Boolean).join(`
`);g.value=T||"Failed to update consultation.",V.value="error",y.value=!0}});g.value=i===1?"Consultation saved as draft.":"Consultation updated successfully.",V.value="success",y.value=!0;const u=((s=r==null?void 0:r.data)==null?void 0:s.attachments)??(r==null?void 0:r.attachments);u?W(u):await J(),C.value=[],N.value=[],R.value++}catch(n){console.error(n),g.value="Failed to update consultation.",V.value="error",y.value=!0}finally{D.value=!1,$.value=!1}}return yt(()=>w.currentLanguage,async()=>{await K()},{immediate:!1}),bt(async()=>{await K(),await J()}),(i,e)=>{const a=ct,s=pt;return m(),_(v,null,{default:l(()=>[o(d,{cols:"12"},{default:l(()=>[o(M,null,{default:l(()=>[o(wt,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),timeout:2400,color:V.value,location:"top right",class:"elevation-24"},{default:l(()=>[f(x(g.value),1)]),_:1},8,["modelValue","color"]),o(O,{class:"pt-0"},{default:l(()=>[B.value?(m(),_(Ct,{key:0,type:"article"})):(m(),_(At,{key:1,class:"mt-0",onSubmit:e[11]||(e[11]=ht(()=>{},["prevent"]))},{default:l(()=>[o(d,{cols:"12",class:"mt-0"},{default:l(()=>[o(et,{variant:"flat",class:"section-bar bg-grey-lighten-3"},{default:l(()=>[c("div",Ft,[o(h,{icon:"tabler-clipboard-text"}),e[12]||(e[12]=c("span",{class:"text-subtitle-1 section-title"},"Update Consultation",-1))])]),_:1})]),_:1}),o(v,null,{default:l(()=>[o(d,{cols:"12"},{default:l(()=>[o(a,{modelValue:t.subject,"onUpdate:modelValue":e[1]||(e[1]=n=>t.subject=n),label:"Subject *","prepend-inner-icon":"tabler-letter-case"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12"},{default:l(()=>[o(s,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=n=>t.description=n),label:"Description","auto-grow":"",rows:"4","prepend-inner-icon":"tabler-file-text"},null,8,["modelValue"])]),_:1})]),_:1}),o(v,null,{default:l(()=>[o(d,{md:"6",cols:"12"},{default:l(()=>[o(ot,{modelValue:t.activity_id,"onUpdate:modelValue":e[3]||(e[3]=n=>t.activity_id=n),items:H.value,loading:k.value,"item-title":"name","item-value":"id",label:"Activity *","prepend-inner-icon":"tabler-list-check",disabled:!H.value.length&&!k.value},null,8,["modelValue","items","loading","disabled"])]),_:1}),o(d,{md:"6",cols:"12"},{default:l(()=>[o(ot,{modelValue:t.type_id,"onUpdate:modelValue":e[4]||(e[4]=n=>t.type_id=n),items:Z.value,loading:k.value,"item-title":"name","item-value":"id",label:"Type","prepend-inner-icon":"tabler-category-2",clearable:"",disabled:!Z.value.length&&!k.value},null,8,["modelValue","items","loading","disabled"])]),_:1})]),_:1}),o(v,null,{default:l(()=>[o(d,{cols:"12"},{default:l(()=>[o(et,{variant:"flat",class:"section-bar bg-grey-lighten-3"},{default:l(()=>[c("div",Lt,[o(h,{icon:"tabler-messages"}),e[13]||(e[13]=c("span",{class:"text-subtitle-1 section-title"},"Contact Methods with the Consultant",-1))])]),_:1})]),_:1}),(m(),U(I,null,q(st,n=>o(d,{cols:"12",md:"6",key:n.key},{default:l(()=>[o(M,{class:gt(["method-card soft-card",[n.className,{"is-selected":t.oppointment_method===n.key}]]),variant:"outlined",onClick:r=>ut(n.key)},{default:l(()=>[o(O,{class:"text-center"},{default:l(()=>[c("div",Tt,[o(h,{icon:n.icon,size:"32"},null,8,["icon"])]),c("div",jt,x(n.title),1),c("div",Bt,x(n.desc),1),c("div",Dt,[o(z,{color:t.oppointment_method===n.key?"primary":"default",variant:"tonal",size:"small"},{default:l(()=>[e[14]||(e[14]=f(" Select this method ")),o(h,{icon:"tabler-check",class:"ms-2"})]),_:2,__:[14]},1032,["color"])])]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024)),64))]),_:1}),t.oppointment_method&&t.oppointment_method!=="none"?(m(),_(v,{key:0},{default:l(()=>[o(d,{cols:"12"},{default:l(()=>[o(M,{class:"details-card",variant:"outlined"},{default:l(()=>[o(O,null,{default:l(()=>[c("div",$t,[o(h,{icon:t.oppointment_method==="session"?"tabler-video":"tabler-message-circle"},null,8,["icon"]),c("span",null,x(t.oppointment_method==="session"?"Video Call":"Instant Chat"),1)]),o(St,{class:"my-4"}),o(v,null,{default:l(()=>[o(d,{cols:"12",md:"6"},{default:l(()=>[o(a,{modelValue:t.oppointment_date,"onUpdate:modelValue":e[5]||(e[5]=n=>t.oppointment_date=n),type:"date",label:"Appointment Date *","prepend-inner-icon":"tabler-calendar"},null,8,["modelValue"])]),_:1}),o(d,{cols:"12",md:"6"},{default:l(()=>[o(a,{modelValue:t.oppointment_time,"onUpdate:modelValue":e[6]||(e[6]=n=>t.oppointment_time=n),type:"time",label:"Time *","prepend-inner-icon":"tabler-clock"},null,8,["modelValue"])]),_:1}),t.oppointment_method==="session"?(m(),_(d,{key:0,cols:"12"},{default:l(()=>[o(a,{modelValue:t.oppointment_url,"onUpdate:modelValue":e[7]||(e[7]=n=>t.oppointment_url=n),label:"Session URL *",placeholder:"Zoom link","prepend-inner-icon":"tabler-link"},null,8,["modelValue"])]),_:1})):X("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):X("",!0),o(v,null,{default:l(()=>[o(d,{cols:"12",md:"8"},{default:l(()=>[o(nt,{class:"text-subtitle-1 mb-1"},{default:l(()=>e[15]||(e[15]=[f("Existing Attachments")])),_:1,__:[15]}),A.value.length?(m(),U("div",Nt,[(m(!0),U(I,null,q(A.value,(n,r)=>(m(),_(lt,{key:"srv-"+r+n.name,label:"",size:"small",color:"primary",class:"me-2 mb-2 attachment-chip",title:n.url||n.name,closable:"","onClick:close":u=>dt(r)},{default:l(()=>[f(x(n.name),1)]),_:2},1032,["title","onClick:close"]))),128))])):(m(),U("div",Et,"No existing attachments.")),o(nt,{class:"text-subtitle-1 mb-1 mt-2"},{default:l(()=>e[16]||(e[16]=[f("Add New Attachments")])),_:1,__:[16]}),(m(),_(Ut,{key:R.value,modelValue:C.value,"onUpdate:modelValue":e[8]||(e[8]=n=>C.value=n),multiple:"",placeholder:"Upload your documents",label:"File input","prepend-icon":"tabler-paperclip",chips:"","show-size":"",counter:"",accept:".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsx"},{selection:l(({fileNames:n})=>[(m(!0),U(I,null,q(n,(r,u)=>(m(),_(lt,{key:"new-"+u+r,label:"",size:"small",color:"primary",class:"me-2 mb-2"},{default:l(()=>[f(x(r),1)]),_:2},1024))),128))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),o(v,null,{default:l(()=>[o(d,{cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:l(()=>[o(z,{loading:$.value,color:"secondary",variant:"tonal",onClick:e[9]||(e[9]=n=>Q(1))},{default:l(()=>[o(h,{icon:"tabler-device-floppy",class:"me-2"}),e[17]||(e[17]=f(" Save (Draft) "))]),_:1,__:[17]},8,["loading"]),o(z,{loading:D.value,color:"primary",onClick:e[10]||(e[10]=n=>Q(2))},{default:l(()=>[o(h,{icon:"tabler-send",class:"me-2"}),e[18]||(e[18]=f(" Update "))]),_:1,__:[18]},8,["loading"])]),_:1})]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})}}},Te=xt(qt,[["__scopeId","data-v-9bdfc2b1"]]);export{Te as default};

import{b9 as j,u as F,aj as U,O as u,aL as z,r as C,ba as S,E as I,w as P,a as A,f as B,o as n,e as r,b as o,c as i,d as a,t as l,l as E,k as O,F as k,h as H,v as J,aF as R,a2 as X,s as q,a9 as G,aX as K,au as Q}from"./index-CbS20ExG.js";import{u as W}from"./useChatStore-CiWrhF5Q.js";import{C as Y}from"./vue3-perfect-scrollbar-BaRDozjp.js";import{a as Z,V as ee}from"./VMain-N8wX2GVL.js";import{V as te}from"./VSpacer-DUT1ZSEj.js";import{V as ae}from"./VDivider-BPwWA21L.js";import{V as M}from"./VAvatar-C2yZhik7.js";import{V as se}from"./VForm-CHeYog45.js";import{V as oe}from"./VTextField-DzzNq7FR.js";import"./useApi-0BfOVZkh.js";import"./createUrl-BUJu4k4M.js";import"./index-CvOPxmL5.js";import"./api-AcZyo7DO.js";import"./ssrBoot-DpKwBNc6.js";/* empty css              */import"./VImg-5Ur9AJ4W.js";import"./form-4mETqBb7.js";import"./forwardRefs-C-GTDzx5.js";/* empty css                   */import"./VCounter-DwLRgA-V.js";import"./VField-5JGCl7yN.js";import"./easing-Bybner-F.js";import"./VInput-CyyzKts-.js";const ne={key:0,class:"d-flex flex-column h-100"},re={class:"active-chat-header d-flex align-center text-medium-emphasis bg-surface"},le={class:"text-h6 font-weight-regular"},ie={class:"pa-4"},ce={key:0,class:"d-flex align-center justify-center h-100"},de={class:"d-flex flex-column align-start message-wrapper"},ue={class:"sender-name mb-1"},me={class:"chat-bubble theirs"},pe={class:"message-text"},ve={class:"time-caption"},fe={class:"d-flex flex-column align-end message-wrapper"},he={class:"sender-name text-end mb-1"},_e={class:"chat-bubble mine"},ge={class:"message-text"},xe={class:"time-caption"},ye={class:"d-flex gap-1"},be={class:"d-none d-md-block"},Ve={key:1,class:"d-flex h-100 align-center justify-center flex-column"},Ce={key:1,class:"text-center text-disabled"},Ge={__name:"[id]",setup(ke){j(t=>({"47c41479":L.value}));const N=F(),_=W(),{name:T}=U(),g=u(()=>N.params.id),h=u(()=>{const t=z("userData").value;return t?typeof t=="string"?JSON.parse(t):t:null}),$=u(()=>h.value&&(`${h.value.first_name||""} ${h.value.last_name||""}`.trim()||h.value.name)||""),c=u(()=>_.consultationChat),x=u(()=>{var t;return(t=c.value)!=null&&t.chat?c.value.chat.map(e=>({id:e.id,text:e.message,sender:e.sender,date:e.date,isMine:e.sender===$.value})):[]}),D=u(()=>c.value?`${c.value.consultation_number} - ${c.value.subject||"Chat"}`:"Consultation Chat"),m=C(""),y=C(null),d=C(!1),b=()=>{Q(()=>{var e;const t=((e=y.value)==null?void 0:e.$el)||y.value;t&&t.scrollTo({top:t.scrollHeight,behavior:"smooth"})})},V=async()=>{const t=m.value.trim();if(!(!t||d.value)){d.value=!0;try{await _.sendConsultationMessage(g.value,t),m.value="",b()}catch(e){console.error("Error sending message:",e)}finally{d.value=!1}}},w=t=>{if(!t)return"";try{const[e,p,s]=t.split("-");return new Date(`${s}-${p}-${e}`).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}catch{return t}},L=u(()=>{var e,p;let t="transparent";return S&&(t=(p=(e=S)==null?void 0:e[T.value].colors)==null?void 0:p.background),t});return I(async()=>{g.value&&(await _.getConsultationChat(g.value),b())}),P(x,()=>{b()},{deep:!0}),(t,e)=>{const p=A("IconBtn");return n(),B(ee,{class:"chat-app-layout",style:{"z-index":"0"}},{default:r(()=>[o(Z,{class:"chat-content-container",style:{width:"100%"}},{default:r(()=>[c.value?(n(),i("div",ne,[a("div",re,[a("div",le,l(D.value),1),o(te)]),o(ae),o(E(Y),{ref_key:"chatLogPS",ref:y,tag:"div",options:{wheelPropagation:!1},class:"flex-grow-1"},{default:r(()=>[a("div",ie,[x.value.length===0?(n(),i("div",ce,e[1]||(e[1]=[a("div",{class:"text-center text-medium-emphasis"},[a("p",null,"No messages yet. Start the conversation!")],-1)]))):O("",!0),(n(!0),i(k,null,H(x.value,s=>(n(),i("div",{key:s.id,class:J(["d-flex mb-4 align-start message-container",s.isMine?"justify-end":"justify-start"])},[s.isMine?(n(),i(k,{key:1},[a("div",fe,[a("div",he,l(s.sender),1),a("div",_e,[a("div",ge,l(s.text),1),a("div",xe,l(w(s.date)),1)])]),o(M,{size:"36",class:"ms-2 flex-shrink-0",variant:"tonal",color:"primary"},{default:r(()=>{var v,f;return[a("span",null,l(((f=(v=s.sender)==null?void 0:v.charAt(0))==null?void 0:f.toUpperCase())||"?"),1)]}),_:2},1024)],64)):(n(),i(k,{key:0},[o(M,{size:"36",class:"me-2 flex-shrink-0",variant:"tonal",color:"primary"},{default:r(()=>{var v,f;return[a("span",null,l(((f=(v=s.sender)==null?void 0:v.charAt(0))==null?void 0:f.toUpperCase())||"?"),1)]}),_:2},1024),a("div",de,[a("div",ue,l(s.sender),1),a("div",me,[a("div",pe,l(s.text),1),a("div",ve,l(w(s.date)),1)])])],64))],2))),128))])]),_:1},512),o(se,{class:"chat-log-message-form mb-5 mx-5",onSubmit:R(V,["prevent"])},{default:r(()=>[o(oe,{modelValue:m.value,"onUpdate:modelValue":e[0]||(e[0]=s=>m.value=s),variant:"solo",density:"default",class:"chat-message-input",placeholder:"Type your message...",disabled:d.value,autofocus:""},{"append-inner":r(()=>[a("div",ye,[a("div",be,[o(X,{"append-icon":"tabler-send",disabled:!m.value.trim()||d.value,loading:d.value,onClick:V},{default:r(()=>e[2]||(e[2]=[q(" Send ")])),_:1,__:[2]},8,["disabled","loading"])]),o(p,{class:"d-block d-md-none",disabled:!m.value.trim()||d.value,onClick:V},{default:r(()=>[o(G,{icon:"tabler-send"})]),_:1},8,["disabled"])])]),_:1},8,["modelValue","disabled"])]),_:1})])):(n(),i("div",Ve,[c.value?(n(),i("div",Ce,e[3]||(e[3]=[a("p",null,"No consultation found",-1)]))):(n(),B(K,{key:0,indeterminate:"",color:"primary"}))]))]),_:1})]),_:1})}}};export{Ge as default};

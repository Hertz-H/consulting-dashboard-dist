import{r as T,p as j,c as L}from"./validators-Bbxa8ORv.js";import{al as H,u as q,r as u,O as X,f as D,o as b,e as t,b as o,l as i,s as R,t as k,aF as z,a2 as G,aX as J,c as K}from"./index-Df0vDIYO.js";import{_ as Q}from"./AppTextField-jGANKBQX.js";import{$ as W}from"./api-BZDa_H6V.js";import{a as v,V as A}from"./VRow-C48oP8rF.js";import{V as Y}from"./VCard-CgfAP4z1.js";import{V as Z}from"./VCardText-CB6nWipv.js";import{V as aa}from"./VSnackbar-U_R2qOlN.js";import{V as F}from"./VAlert-CJF6bZaU.js";import{V as ea}from"./VForm-LJs8z4wK.js";import{u as ra}from"./useApi-CrpjD065.js";import"./helpers-DK5QwNv0.js";import"./VLabel-X6aAEUPa.js";import"./VTextField-Bk-xicTH.js";/* empty css                   */import"./VCounter-CDNaFmaS.js";import"./VImg-D-iRAKzb.js";import"./VField-uLTC6ZdN.js";import"./form-CH_H7Z9j.js";import"./easing-Bybner-F.js";import"./VInput-DH7V_F8-.js";import"./forwardRefs-C-GTDzx5.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-BSK7_YRS.js";import"./VOverlay-CEc4fXoL.js";import"./delay-FQ7L2EsZ.js";import"./lazy-B5EM0j6M.js";import"./scopeId-DhzGCC8_.js";const sa={__name:"UserTabSecurity",setup(O){const{t:e}=H(),V=q(),p=u(!1),c=u(!1),d=u(""),m=u(""),_=u(null),n=u({password:"",password_confirmation:""}),E=()=>{n.value.password="",n.value.password_confirmation=""},g=u(!1),I=u(""),C=u("success"),y=u(!1),f=(r,a="success")=>{I.value=r,C.value=a,g.value=!0},B=r=>{if(!r||typeof r!="object")return"";const a=Object.values(r).flat().filter(Boolean)[0];return a?String(a):""},N=X(()=>({password:d.value,password_confirmation:m.value})),S=async()=>{var a,w,l,h;E();const r=await((w=(a=_.value)==null?void 0:a.validate)==null?void 0:w.call(a));if(!(r&&r.valid===!1)){if(!d.value||!m.value){f(e("userPassword.messages.fillRequired"),"error");return}if(d.value!==m.value){n.value.password_confirmation=e("userPassword.validation.passwordMismatch"),f(e("userPassword.messages.passwordMismatch"),"error");return}y.value=!0;try{await W(`/v1/users/${V.params.id}/changePassword`,{method:"PATCH",body:N.value,onResponseError({response:s}){var $,x;if((s==null?void 0:s.status)===422){const P=(($=s==null?void 0:s._data)==null?void 0:$.errors)||{};n.value.password=(P.password||[]).join(" "),n.value.password_confirmation=(P.password_confirmation||[]).join(" ");const U=B(P);throw f(U||e("userPassword.messages.validationFailed"),"error"),new Error("VALIDATION_ERROR")}const M=((x=s==null?void 0:s._data)==null?void 0:x.message)||e("userPassword.messages.failed");throw f(M,"error"),new Error("API_ERROR")}}),f(e("userPassword.messages.success"),"success"),d.value="",m.value="",E(),(h=(l=_.value)==null?void 0:l.resetValidation)==null||h.call(l)}catch(s){if((s==null?void 0:s.message)==="VALIDATION_ERROR"||(s==null?void 0:s.message)==="API_ERROR")return;f(e("userPassword.messages.unexpected"),"error")}finally{y.value=!1}}};return(r,a)=>{const w=Q;return b(),D(A,null,{default:t(()=>[o(v,{cols:"12"},{default:t(()=>[o(Y,{title:i(e)("userPassword.title")},{default:t(()=>[o(Z,null,{default:t(()=>[o(aa,{modelValue:g.value,"onUpdate:modelValue":a[0]||(a[0]=l=>g.value=l),timeout:2400,color:C.value,class:"elevation-24",location:"top right"},{default:t(()=>[R(k(I.value),1)]),_:1},8,["modelValue","color"]),o(F,{closable:"",variant:"tonal",color:"warning",class:"mb-4",title:i(e)("userPassword.alert.title"),text:i(e)("userPassword.alert.text")},null,8,["title","text"]),o(ea,{ref_key:"formRef",ref:_,onSubmit:z(S,["prevent"])},{default:t(()=>[o(A,null,{default:t(()=>[o(v,{cols:"12",md:"6"},{default:t(()=>[o(w,{modelValue:d.value,"onUpdate:modelValue":a[1]||(a[1]=l=>d.value=l),label:i(e)("userPassword.fields.newPassword"),placeholder:"············",rules:["requiredValidator"in r?r.requiredValidator:i(T),"passwordValidator"in r?r.passwordValidator:i(j)],error:!!n.value.password,"error-messages":n.value.password?[n.value.password]:[],type:p.value?"text":"password","append-inner-icon":p.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[2]||(a[2]=l=>p.value=!p.value)},null,8,["modelValue","label","rules","error","error-messages","type","append-inner-icon"])]),_:1}),o(v,{cols:"12",md:"6"},{default:t(()=>[o(w,{modelValue:m.value,"onUpdate:modelValue":a[3]||(a[3]=l=>m.value=l),label:i(e)("userPassword.fields.confirmPassword"),autocomplete:"confirm-password",placeholder:"············",rules:["requiredValidator"in r?r.requiredValidator:i(T),("confirmedValidator"in r?r.confirmedValidator:i(L))(m.value,d.value)],error:!!n.value.password_confirmation,"error-messages":n.value.password_confirmation?[n.value.password_confirmation]:[],type:c.value?"text":"password","append-inner-icon":c.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":a[4]||(a[4]=l=>c.value=!c.value)},null,8,["modelValue","label","rules","error","error-messages","type","append-inner-icon"])]),_:1}),o(v,{cols:"12"},{default:t(()=>[o(G,{type:"submit",loading:y.value,color:"primary"},{default:t(()=>[R(k(i(e)("userPassword.actions.change")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},512)]),_:1})]),_:1},8,["title"])]),_:1})]),_:1})}}},oa={key:1},Da={__name:"[id]",async setup(O){let e,V;const p=q();u(null);const{data:c}=([e,V]=J(()=>ra(`/v1/users/${p.params.id}`)),e=await e,V(),e);return(d,m)=>i(c)?(b(),D(A,{key:0},{default:t(()=>[o(v,{cols:"12",md:"7",lg:"8"},{default:t(()=>[o(sa)]),_:1})]),_:1})):(b(),K("div",oa,[o(F,{type:"error",variant:"tonal"},{default:t(()=>[R(" Invoice with ID "+k(i(p).params.id)+" not found! ",1)]),_:1})]))}};export{Da as default};

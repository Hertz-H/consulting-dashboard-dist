import{r as P,p as I,c as N}from"./validators-DOkm11CL.js";import{r as i,u as k,O as S,f as C,o as w,e as r,b as t,s as _,t as h,aF as T,l as c,a2 as x,aW as D,c as F}from"./index-BxU12KgC.js";import{_ as U}from"./AppTextField-CLvxn6_C.js";import{$ as j}from"./api-Ba7n58ZI.js";import{a as f,V as y}from"./VRow--HD-L7TS.js";import{V as M}from"./VCard-CslEgE47.js";import{V as R}from"./VCardText-CTVtF3nt.js";import{V as O}from"./VSnackbar-B_Z8K1Tu.js";import{V as $}from"./VAlert-CYMg6DEX.js";import{V as H}from"./VForm-BT--ttCz.js";import{u as W}from"./useApi-Cyqe7-X3.js";import"./helpers-DK5QwNv0.js";import"./form-BXvCDZ_7.js";import"./VTextField-D5CDNjP_.js";/* empty css                   */import"./VCounter-DG6qVdKp.js";import"./VImg-BWtlGard.js";import"./VField-mQ2GfzOK.js";import"./easing-Bybner-F.js";import"./VInput-DkirN1Ab.js";import"./forwardRefs-C-GTDzx5.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-BhdHmQHY.js";import"./VOverlay-CaKMC9uw.js";import"./delay-BHM9Rsm9.js";import"./lazy-DtMngAEq.js";import"./scopeId-Bt4u8XlJ.js";const z={__name:"UserTabSecurity",setup(A){const s=i(!1),d=i(!1),o=i(""),u=i(""),b=k(),n=i(!1),m=i(""),p=i("deep-purple-accent-4"),V=i(!1);async function q(a){if(a&&a.status&&!a.ok)try{return await a.json()}catch{return{message:`API Error (Status ${a.status})`}}return{message:(a==null?void 0:a.message)||"Network error"}}const B=S(()=>({password:o.value,password_confirmation:u.value})),E=async()=>{if(!o.value||!u.value){m.value="Please fill all required fields.",p.value="error",n.value=!0;return}if(o.value!==u.value){m.value="Passwords do not match.",p.value="error",n.value=!0;return}V.value=!0;try{await j(`/v1/users/${b.params.id}/changePassword`,{method:"PATCH",body:B.value,onResponseError({response:a}){var l,g;const e=((l=a==null?void 0:a._data)==null?void 0:l.errors)||{},v=Object.values(e).flat().filter(Boolean).join(`
`);m.value=v||(((g=a==null?void 0:a._data)==null?void 0:g.message)??"Failed to change password."),p.value="error",n.value=!0}}),m.value="Password changed successfully.",p.value="success",n.value=!0,o.value="",u.value=""}catch(a){const e=await q(a);m.value=(e==null?void 0:e.message)||"An unexpected error occurred.",p.value="error",n.value=!0}finally{V.value=!1}};return(a,e)=>{const v=U;return w(),C(y,null,{default:r(()=>[t(f,{cols:"12"},{default:r(()=>[t(M,{title:"Change Password"},{default:r(()=>[t(R,null,{default:r(()=>[t(O,{modelValue:n.value,"onUpdate:modelValue":e[0]||(e[0]=l=>n.value=l),timeout:2400,color:p.value,class:"elevation-24",location:"top right"},{default:r(()=>[_(h(m.value),1)]),_:1},8,["modelValue","color"]),t($,{closable:"",variant:"tonal",color:"warning",class:"mb-4",title:"Ensure that these requirements are met",text:"Minimum 8 characters long, uppercase & symbol"}),t(H,{onSubmit:T(E,["prevent"])},{default:r(()=>[t(y,null,{default:r(()=>[t(f,{cols:"12",md:"6"},{default:r(()=>[t(v,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=l=>o.value=l),label:"New Password",placeholder:"············",rules:["requiredValidator"in a?a.requiredValidator:c(P),"passwordValidator"in a?a.passwordValidator:c(I)],type:s.value?"text":"password","append-inner-icon":s.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[2]||(e[2]=l=>s.value=!s.value)},null,8,["modelValue","rules","type","append-inner-icon"])]),_:1}),t(f,{cols:"12",md:"6"},{default:r(()=>[t(v,{modelValue:u.value,"onUpdate:modelValue":e[3]||(e[3]=l=>u.value=l),label:"Confirm Password",autocomplete:"confirm-password",placeholder:"············",rules:["requiredValidator"in a?a.requiredValidator:c(P),("confirmedValidator"in a?a.confirmedValidator:c(N))(u.value,o.value)],type:d.value?"text":"password","append-inner-icon":d.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[4]||(e[4]=l=>d.value=!d.value)},null,8,["modelValue","rules","type","append-inner-icon"])]),_:1}),t(f,{cols:"12"},{default:r(()=>[t(x,{type:"submit",loading:V.value,color:"primary"},{default:r(()=>e[5]||(e[5]=[_(" Change Password ")])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},G={key:1},ga={__name:"[id]",async setup(A){let s,d;const o=k();i(null);const{data:u}=([s,d]=D(()=>W(`/v1/users/${o.params.id}`)),s=await s,d(),s);return(b,n)=>c(u)?(w(),C(y,{key:0},{default:r(()=>[t(f,{cols:"12",md:"7",lg:"8"},{default:r(()=>[t(z)]),_:1})]),_:1})):(w(),F("div",G,[t($,{type:"error",variant:"tonal"},{default:r(()=>[_(" Invoice with ID "+h(c(o).params.id)+" not found! ",1)]),_:1})]))}};export{ga as default};

import{bd as R,bc as h,O as v,r as d,aL as a}from"./index-BxU12KgC.js";import{g as x,c as L,u as M}from"./useApi-Cyqe7-X3.js";const u=d(null),n=d(null);function S(e){return e?e.abilities&&Array.isArray(e.abilities)?e.abilities:[{action:"manage",subject:"all"}]:[]}function j(){const e=R(),f=h(),k=v(()=>!!x()&&(!n.value||Date.now()<n.value)),g=v(()=>{var t;return(((t=u.value)==null?void 0:t.status)??0)===1}),y=v(()=>n.value?Math.max(0,n.value-Date.now()):null);async function p({email:t,phone:l,password:o}){var A,m;const T={identifier:t||l,password:o,token_name:"web"},{data:c,error:i}=await M("/v1/login").post(T).json();if(i!=null&&i.value){const D=((m=(A=i.value)==null?void 0:A.data)==null?void 0:m.message)||"Login failed";throw new Error(D)}const r=(c==null?void 0:c.value)||{},C=r.token,s=r.data||null;u.value=s;const b=S(s);return e.setUser(s),e.setClient(s.client),e.setOffice(s.office),a("userData").value=s,a("accessToken").value=C,a("userAbilityRules").value=b,f.update(b),e.isLoginUser(),{user:s,message:r.message,isVerified:g.value}}function w(){const t=a("accessToken"),l=a("userData"),o=a("userAbilityRules");t.value=null,l.value=null,o.value=null,f.update([]),e.clearUser(),u.value=null,n.value=null,L()}return{user:u,isAuthenticated:k,isVerified:g,remainingMs:y,login:p,logout:w}}export{j as u};

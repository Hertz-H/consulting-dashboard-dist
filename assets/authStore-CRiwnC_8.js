import{bd as D,bc as R,O as v,r as y,aL as a}from"./index-BVpKynl4.js";import{g as x,c as L,u as M}from"./useApi-C1A9lyWN.js";const l=y(null),i=y(null);function S(e){return e?e.abilities&&Array.isArray(e.abilities)?e.abilities:[{action:"manage",subject:"all"}]:[]}function j(){const e=D(),f=R(),d=v(()=>!!x()&&(!i.value||Date.now()<i.value)),b=v(()=>{var t;return(((t=l.value)==null?void 0:t.status)??0)===1}),k=v(()=>i.value?Math.max(0,i.value-Date.now()):null);async function p({email:t,phone:o,password:u}){var A,m;const w={identifier:t||o,password:u,token_name:"web"},{data:r,error:n}=await M("/v1/login").post(w).json();if(n!=null&&n.value){console.log(n.value,"login error");const C=((m=(A=n.value)==null?void 0:A.data)==null?void 0:m.message)||"Login failed";throw new Error(C)}const c=(r==null?void 0:r.value)||{},T=c.token,s=c.data||null;l.value=s;const g=S(s);return e.setUser(s),console.log(e.user,"user in the store"),e.setClient(s.client),e.setOffice(s.office),a("userData").value=s,a("accessToken").value=T,a("userAbilityRules").value=g,f.update(g),console.log("this is the user ability rules",g),e.isLoginUser(),{user:s,message:c.message,isVerified:b.value}}function h(){const t=a("accessToken"),o=a("userData"),u=a("userAbilityRules");t.value=null,o.value=null,u.value=null,f.update([]),e.clearUser(),l.value=null,i.value=null,L()}return{user:l,isAuthenticated:d,isVerified:b,remainingMs:k,login:p,logout:h}}export{j as u};

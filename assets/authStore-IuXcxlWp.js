import{bd as D,aL as R,O as v,r as m,aM as a}from"./index-D_BsgN_d.js";import{g as M,c as x,u as S}from"./useApi-CM-u9C21.js";const u=m(null),n=m(null);function U(e){return e?e.abilities&&Array.isArray(e.abilities)?e.abilities:[{action:"manage",subject:"all"}]:[]}function L(){const e=D(),f=R(),k=v(()=>!!M()&&(!n.value||Date.now()<n.value)),b=v(()=>{var t;return(((t=u.value)==null?void 0:t.status)??0)===1}),y=v(()=>n.value?Math.max(0,n.value-Date.now()):null);async function p({email:t,phone:l,password:o}){var A,d;const T={identifier:t||l,password:o,token_name:"web"},{data:r,error:i}=await S("/v1/dashboard/login").post(T).json();if(i!=null&&i.value){const C=((d=(A=i.value)==null?void 0:A.data)==null?void 0:d.message)||"الايميل أو كلمة المرور غير صحيحة";throw new Error(C)}const c=(r==null?void 0:r.value)||{},h=c.token,s=c.data||null;u.value=s;const g=U(s);return e.setUser(s),e.setClient(s.client),e.setOffice(s.office),a("userData").value=s,a("accessToken").value=h,a("userAbilityRules").value=g,f.update(g),e.isLoginUser(),{user:s,message:c.message,isVerified:b.value}}function w(){const t=a("accessToken"),l=a("userData"),o=a("userAbilityRules");t.value=null,l.value=null,o.value=null,f.update([]),e.clearUser(),u.value=null,n.value=null,x()}return{user:u,isAuthenticated:k,isVerified:b,remainingMs:y,login:p,logout:w}}export{L as u};

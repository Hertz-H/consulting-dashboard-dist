import{_ as J}from"./AppTextarea-DrBRnrXd.js";import{_ as Q}from"./AppTextField-BylwOX1I.js";import{al as W,r as m,O as D,bb as X,w as Y,E as tt,f as V,e as l,o as _,b as o,s as b,t as h,aF as et,k as N,d as r,a9 as d,c as M,F as O,h as R,v as ot,a2 as C}from"./index-BvPjFTGu.js";import{u as lt}from"./globalStore-DdLuzmMX.js";import{f as nt}from"./images-DNnnEzYI.js";import{$ as at}from"./api-CTSccuME.js";import{_ as it}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as u,a as i}from"./VRow-BMk9_fNn.js";import{V as T}from"./VCard-CePL1EOL.js";import{V as st}from"./VSnackbar-C__rX3QR.js";import{V as $}from"./VCardText-JGefx1Q0.js";import{V as rt}from"./VForm-DxcVrSCN.js";import{V as z}from"./VSheet-RTz7YF4x.js";import{V as E}from"./VSelect-CUS7aVT3.js";import{V as pt}from"./VFileInput-nHpx_ubn.js";import{V as mt}from"./VChip-BbtL5ySO.js";import{V as dt}from"./VDivider-2Bv_8Jov.js";import"./form-BiCiRZ1j.js";import"./VTextarea-Dj-sJ64g.js";/* empty css                   */import"./VCounter-B19M3XdA.js";import"./VImg-DnWpPi9K.js";import"./VField-D-Q4NJj0.js";import"./easing-Bybner-F.js";import"./VInput-Bu8JHkCj.js";import"./forwardRefs-C-GTDzx5.js";import"./VTextField-N2SGzGBo.js";import"./index-CvOPxmL5.js";/* empty css              */import"./VAvatar-Ce5tSu__.js";import"./VOverlay-D2sQOqfD.js";import"./delay-B1dxxJfC.js";import"./lazy-DaFJvBXA.js";import"./scopeId-wKNjEvHw.js";import"./VList-jvYjHTU1.js";import"./ssrBoot-K_ycCVMn.js";import"./dialog-transition-CM7nAX3a.js";import"./VMenu-BLpoVuPm.js";import"./VCheckboxBtn-CEAJsFVX.js";import"./VSelectionControl-Bh0_3Wfm.js";import"./VSlideGroup-Dk8XVwmJ.js";const ut={class:"d-flex align-center gap-2"},ct={class:"d-flex align-center gap-2"},_t={class:"mx-auto icon-pill"},ft={class:"text-h6 mt-2 fw-600"},vt={class:"text-body-2 mt-1 subtle"},bt={class:"text-center mt-4"},yt={class:"details-title d-flex align-center gap-2"},Vt="/v1/consultations",ht="POST",gt={__name:"create",setup(kt){const w=lt(),{locale:L}=W({useScope:"global"}),y=m(!1),g=m(""),k=m("deep-purple-accent-4"),S=m(!1),j=m(!1),f=m(!1),A=m(0),c=m([]),B=D(()=>w.activities||[]),F=D(()=>w.consultations_types||[]),P=[{key:"chat",title:"Instant Chat",desc:"Instant text chat with the consultant through the platform",icon:"tabler-message-circle",className:"soft-chat"},{key:"session",title:"Video Call",desc:"Live video session via Zoom with screen sharing",icon:"tabler-video",className:"soft-video"}],t=X({subject:"",description:"",activity_id:null,type_id:null,attachments:[],oppointment_method:null,oppointment_date:null,oppointment_time:null,oppointment_url:""}),Z=D(()=>{var e,s;if(!((e=t.subject)!=null&&e.trim())||!t.activity_id)return!1;if(!t.oppointment_method)return!0;const a=!!t.oppointment_date&&!!t.oppointment_time;return t.oppointment_method==="chat"?a:t.oppointment_method==="session"?a&&!!((s=t.oppointment_url)!=null&&s.trim()):!0});async function q(){f.value=!0;try{await w.fetchFeedData()}finally{f.value=!1}}Y(L,()=>{q()},{immediate:!1}),tt(q);function G(a){t.oppointment_method=a,t.oppointment_date=null,t.oppointment_time=null,a!=="session"&&(t.oppointment_url="")}async function H(a){var s,v,n,p;try{t.attachments=(s=c.value)!=null&&s.length?await nt(c.value):[]}catch{t.attachments=[]}const e={subject:((v=t.subject)==null?void 0:v.trim())||"",description:((n=t.description)==null?void 0:n.trim())||"",activity_id:t.activity_id,status_id:a,attachments:t.attachments};return t.oppointment_method&&(e.oppointment_method=t.oppointment_method),(t.oppointment_method==="chat"||t.oppointment_method==="session")&&(e.oppointment_date=t.oppointment_date,e.oppointment_time=t.oppointment_time),t.oppointment_method==="session"&&((p=t.oppointment_url)!=null&&p.trim())&&(e.oppointment_url=t.oppointment_url.trim()),t.type_id!=null&&t.type_id!==""&&(e.type_id=t.type_id),e}function K(a){c.value.splice(a,1)}async function I(a){var e,s;if(!Z.value){g.value=(e=t.subject)!=null&&e.trim()?t.activity_id?t.oppointment_method&&!t.oppointment_date?"Appointment date is required.":t.oppointment_method&&!t.oppointment_time?"Appointment time is required.":t.oppointment_method==="session"&&!((s=t.oppointment_url)!=null&&s.trim())?"Session URL is required.":"Please check required fields.":"Activity is required.":"Subject is required.",k.value="error",y.value=!0;return}a===1?j.value=!0:S.value=!0;try{const v=await H(a);await at(Vt,{method:ht,body:v,onResponseError({response:n}){var U;const p=((U=n._data)==null?void 0:U.errors)||{},x=Object.values(p).flat().filter(Boolean).join(`
`);g.value=x||"Failed to create consultation.",k.value="error",y.value=!0}}),g.value=a===1?"Consultation saved as draft.":"Consultation created successfully.",k.value="success",y.value=!0,t.subject="",t.description="",t.type_id=null,t.oppointment_method=null,t.oppointment_date=null,t.oppointment_time=null,t.oppointment_url="",c.value=[],A.value++}finally{S.value=!1,j.value=!1}}return(a,e)=>{const s=Q,v=J;return _(),V(u,null,{default:l(()=>[o(i,{cols:"12"},{default:l(()=>[o(T,null,{default:l(()=>[o(st,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=n=>y.value=n),timeout:2400,color:k.value,location:"top right",class:"elevation-24"},{default:l(()=>[b(h(g.value),1)]),_:1},8,["modelValue","color"]),o($,{class:"pt-0"},{default:l(()=>[o(rt,{class:"mt-0",onSubmit:e[12]||(e[12]=et(()=>{},["prevent"]))},{default:l(()=>[o(i,{cols:"12",class:"mt-0"},{default:l(()=>[o(z,{variant:"flat",class:"section-bar bg-grey-lighten-3"},{default:l(()=>[r("div",ut,[o(d,{icon:"tabler-clipboard-text"}),e[13]||(e[13]=r("span",{class:"text-subtitle-1 section-title"},"Create Consultation",-1))])]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(i,{cols:"12"},{default:l(()=>[o(s,{modelValue:t.subject,"onUpdate:modelValue":e[1]||(e[1]=n=>t.subject=n),label:"Subject *",placeholder:"Relationship management in corporate banking services","prepend-inner-icon":"tabler-letter-case"},null,8,["modelValue"])]),_:1}),o(i,{cols:"12"},{default:l(()=>[o(v,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=n=>t.description=n),label:"Description",placeholder:"Describe the consultation...","auto-grow":"",rows:"4","prepend-inner-icon":"tabler-file-text"},null,8,["modelValue"])]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(i,{md:"6",cols:"12"},{default:l(()=>[o(E,{modelValue:t.activity_id,"onUpdate:modelValue":e[3]||(e[3]=n=>t.activity_id=n),items:B.value,loading:f.value,"item-title":"name","item-value":"id",label:"Activity *","prepend-inner-icon":"tabler-list-check",hint:t.activity_id?"":"Required","persistent-hint":"",disabled:!B.value.length&&!f.value},null,8,["modelValue","items","loading","hint","disabled"])]),_:1}),o(i,{md:"6",cols:"12"},{default:l(()=>[o(E,{modelValue:t.type_id,"onUpdate:modelValue":e[4]||(e[4]=n=>t.type_id=n),items:F.value,loading:f.value,"item-title":"name","item-value":"id",label:"Type","prepend-inner-icon":"tabler-category-2",clearable:"",disabled:!F.value.length&&!f.value},null,8,["modelValue","items","loading","disabled"])]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(i,{cols:"12"},{default:l(()=>[(_(),V(pt,{key:A.value,modelValue:c.value,"onUpdate:modelValue":e[5]||(e[5]=n=>c.value=n),multiple:"",label:"Attachments (optional)","prepend-icon":"tabler-paperclip",chips:"","show-size":"",counter:"",accept:".pdf,.jpg,.jpeg,.png,.gif,.doc,.docx,.xls,.xlsx"},{selection:l(({fileNames:n})=>[(_(!0),M(O,null,R(n,(p,x)=>(_(),V(mt,{key:"att-"+x+p,label:"",size:"small",color:"primary",class:"me-2 mb-2",closable:"","onClick:close":U=>K(x)},{default:l(()=>[b(h(p),1)]),_:2},1032,["onClick:close"]))),128))]),_:1},8,["modelValue"]))]),_:1})]),_:1}),o(u,null,{default:l(()=>[o(i,{cols:"12"},{default:l(()=>[o(z,{variant:"flat",class:"section-bar bg-grey-lighten-3"},{default:l(()=>[r("div",ct,[o(d,{icon:"tabler-messages"}),e[14]||(e[14]=r("span",{class:"text-subtitle-1 section-title"},"Contact Methods with the Consultant",-1))])]),_:1})]),_:1}),(_(),M(O,null,R(P,n=>o(i,{cols:"12",md:"6",key:n.key},{default:l(()=>[o(T,{class:ot(["method-card soft-card",[n.className,{"is-selected":t.oppointment_method===n.key}]]),variant:"outlined",onClick:p=>G(n.key)},{default:l(()=>[o($,{class:"text-center"},{default:l(()=>[r("div",_t,[o(d,{icon:n.icon,size:"32"},null,8,["icon"])]),r("div",ft,h(n.title),1),r("div",vt,h(n.desc),1),r("div",bt,[o(C,{color:t.oppointment_method===n.key?"primary":"default",variant:"tonal",size:"small"},{default:l(()=>[e[15]||(e[15]=b(" Select this method ")),o(d,{icon:"tabler-check",class:"ms-2"})]),_:2,__:[15]},1032,["color"])])]),_:2},1024)]),_:2},1032,["class","onClick"])]),_:2},1024)),64))]),_:1}),t.oppointment_method?(_(),V(u,{key:0},{default:l(()=>[o(i,{cols:"12"},{default:l(()=>[o(T,{class:"details-card",variant:"outlined"},{default:l(()=>[o($,null,{default:l(()=>[r("div",yt,[o(d,{icon:t.oppointment_method==="session"?"tabler-video":"tabler-message-circle"},null,8,["icon"]),r("span",null,h(t.oppointment_method==="session"?"Video Call":"Instant Chat"),1)]),o(dt,{class:"my-4"}),o(u,null,{default:l(()=>[o(i,{cols:"12",md:"6"},{default:l(()=>[o(s,{modelValue:t.oppointment_date,"onUpdate:modelValue":e[6]||(e[6]=n=>t.oppointment_date=n),type:"date",label:"Appointment Date *","prepend-inner-icon":"tabler-calendar"},null,8,["modelValue"])]),_:1}),o(i,{cols:"12",md:"6"},{default:l(()=>[o(s,{modelValue:t.oppointment_time,"onUpdate:modelValue":e[7]||(e[7]=n=>t.oppointment_time=n),type:"time",label:"Time *","prepend-inner-icon":"tabler-clock"},null,8,["modelValue"])]),_:1}),t.oppointment_method==="session"?(_(),V(i,{key:0,cols:"12"},{default:l(()=>[o(s,{modelValue:t.oppointment_url,"onUpdate:modelValue":e[8]||(e[8]=n=>t.oppointment_url=n),label:"Session URL *",placeholder:"Zoom link","prepend-inner-icon":"tabler-link"},null,8,["modelValue"])]),_:1})):N("",!0)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):N("",!0),o(u,null,{default:l(()=>[o(i,{cols:"12",class:"d-flex flex-wrap gap-4 mt-4"},{default:l(()=>[o(C,{loading:j.value,color:"secondary",variant:"tonal",onClick:e[9]||(e[9]=n=>I(1))},{default:l(()=>[o(d,{icon:"tabler-device-floppy",class:"me-2"}),e[16]||(e[16]=b(" Save (Draft) "))]),_:1,__:[16]},8,["loading"]),o(C,{loading:S.value,color:"primary",onClick:e[10]||(e[10]=n=>I(2))},{default:l(()=>[o(d,{icon:"tabler-send",class:"me-2"}),e[17]||(e[17]=b(" Create "))]),_:1,__:[17]},8,["loading"]),o(C,{color:"default",variant:"text",onClick:e[11]||(e[11]=n=>{t.subject="",t.description="",t.type_id=null,t.oppointment_method=null,t.oppointment_date=null,t.oppointment_time=null,t.oppointment_url="",c.value=[],A.value++})},{default:l(()=>[o(d,{icon:"tabler-eraser",class:"me-2"}),e[18]||(e[18]=b(" Clear "))]),_:1,__:[18]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}}},me=it(gt,[["__scopeId","data-v-9788a50a"]]);export{me as default};

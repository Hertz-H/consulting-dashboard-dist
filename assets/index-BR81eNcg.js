import{_ as re}from"./TablePagination-DMxhjePK.js";import{_ as ue}from"./AppDateTimePicker-Cs_usY5u.js";import{_ as ce}from"./AppSelect-CDuCHJJN.js";import{_ as de}from"./AppTextField-B_Hg2V0D.js";import{u as me}from"./useApi-Dcbdi9nb.js";import{c as pe}from"./createUrl-w7QDhdQJ.js";import{$ as ve}from"./api-CdP6DVdi.js";import{V as fe}from"./VNavigationDrawer-BXjgVPmi.js";import{V as Y}from"./VCard-CvoYH-tB.js";import{V as G,a as _e}from"./VToolbar-DC6uBGuH.js";import{V as J}from"./VSpacer-BDvFYnO8.js";import{al as be,r as c,w as K,aX as ge,O as P,c as O,b as l,e as o,a as he,o as z,s as m,t as s,l as r,a2 as x,a9 as p,d as n,F as W,h as ye,f as Ve,k as Pe,v as xe,p as we}from"./index-C7qtdPxF.js";import{V as B}from"./VDivider-_zTHJTS9.js";import{V as ke}from"./VSheet-DN0xJD9A.js";import{V as Te}from"./VCardText--YnIOn_v.js";import{V as Ce,a as De}from"./VRow-B7mc-M76.js";import{V as M}from"./VAvatar-G0k920wU.js";import{V as Se}from"./VDataTableServer-BK3527GT.js";import{V as Ne}from"./VMenu-I2_LsuYP.js";import{V as $e,a as Z,b as ee}from"./VList-Dy3hiU5v.js";import{V as Ae}from"./VTooltip-VvyISUhb.js";import"./VPagination-BTWbNfov.js";import"./VField-BqJwITnM.js";import"./VLabel-BL0IdVQU.js";import"./form-ZFmfzYYs.js";import"./easing-Bybner-F.js";import"./VInput-CbX7aBHh.js";import"./VImg-CqiRrtog.js";import"./VSelect-LtwgNZ1_.js";import"./VTextField-BsIs5QE9.js";/* empty css                   */import"./VCounter-Cj1o1Vys.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-Bjxq3jQa.js";import"./VOverlay-CWnbyjJr.js";import"./delay-DqFvUsxw.js";import"./lazy-CS65LDuN.js";import"./scopeId-CskrSFPb.js";import"./VCheckboxBtn-DtO76zpK.js";import"./VSelectionControl-B5WYu4tx.js";import"./VChip-0oIqGjbL.js";import"./VSlideGroup-D5YnXd4F.js";import"./index-CvOPxmL5.js";import"./ssrBoot-DTheOfQd.js";/* empty css              */import"./VDataTable-CkvRXYf-.js";import"./VTable-B4rWIEzF.js";import"./filter-DjVrZkvV.js";const Le={class:"text-body-2 font-weight-medium mb-1 d-block"},Ue={class:"text-body-2 font-weight-medium mb-1 d-block"},Ie={class:"text-body-2 font-weight-medium mb-1 d-block"},Fe={class:"text-body-2 font-weight-medium mb-1 d-block"},Re={class:"d-flex gap-2"},ze={class:"d-flex justify-space-between mt-2"},Be={class:"d-flex flex-column"},je={class:"text-h4"},Ee={class:"text-body-1 text-capitalize"},Oe={class:"d-flex gap-4 align-center flex-wrap"},Me={class:"d-flex align-center gap-2"},qe={class:"text-medium-emphasis text-body-2"},He={class:"pa-8 text-center"},Qe={class:"text-h6 mb-1"},Xe={class:"text-body-2 text-medium-emphasis mb-4"},Ye={class:"mb-0"},Ge={class:"mb-0"},Je={class:"mb-0"},Ke={class:"d-flex align-center"},We={class:"d-flex flex-column"},Ze={class:"text-link font-weight-medium"},et={class:"text-sm text-medium-emphasis"},tt={class:"text-sm text-medium-emphasis"},Kt={__name:"index",async setup(at){let N,q;const{t:i}=be(),w=c(""),k=c(null),$=c([]),T=c(null),C=c(null),D=c(null),S=c(!1),b=c(void 0),g=c(void 0),v=c(10),f=c(1),A=c(),L=c(),te=t=>{var e,u,d,h;A.value=(u=(e=t.sortBy)==null?void 0:e[0])==null?void 0:u.key,L.value=(h=(d=t.sortBy)==null?void 0:d[0])==null?void 0:h.order,v.value=t.itemsPerPage,f.value=t.page},U=t=>Number(t??0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),ae=t=>t?t.split(" ").map(e=>e[0]).join("").toUpperCase():"?",V=t=>t?t instanceof Date?t.toISOString().slice(0,10):String(t).slice(0,10):void 0,le=t=>{const e=String(t||"").toLowerCase();return e==="paid"?i("invoicesPage.status.paid"):e==="unpaid"?i("invoicesPage.status.unpaid"):e==="cancelled"?i("invoicesPage.status.cancelled"):t||"â€”"};K(T,t=>{if(!t){b.value=void 0,g.value=void 0;return}if(Array.isArray(t)){const[e,u]=t;b.value=V(e),g.value=V(u);return}if(typeof t=="object"){b.value=V(t.start),g.value=V(t.end);return}if(typeof t=="string"){const e=t.split(" to ");b.value=V(e[0]||""),g.value=V(e[1]||"");return}b.value=void 0,g.value=void 0},{immediate:!0});const H=()=>{w.value="",k.value=null,T.value=null,C.value=null,D.value=null,b.value=void 0,g.value=void 0,f.value=1,A.value=void 0,L.value=void 0},{data:j,execute:Q}=([N,q]=ge(()=>me(pe("/v1/invoices",{query:{search:w,status:k,issued_from:b,issued_to:g,min_total:C,max_total:D,itemsPerPage:v,page:f,sortBy:A,orderBy:L}}))),N=await N,q(),N);K([w,k,T,C,D,v,f,A,L],()=>Q(),{immediate:!0});const E=P(()=>{var R;const t=((R=j.value)==null?void 0:R.summary)??{},e=y=>typeof y=="number"?y:y&&typeof y=="object"?Number(y.total??0):0,u=(t.paid!==void 0?e(t.paid):void 0)??Number(t.paid_total??t.paidTotal??0),d=(t.unpaid!==void 0?e(t.unpaid):void 0)??Number(t.unpaid_total??t.unpaidTotal??0),h=(t.cancelled!==void 0?e(t.cancelled):void 0)??Number(t.cancelled_total??t.cancelledTotal??0);return{paid:{total:Number.isFinite(u)?u:0},unpaid:{total:Number.isFinite(d)?d:0},cancelled:{total:Number.isFinite(h)?h:0},clients_count:Number(t.clients_count??t.clientsCount??0),consultants_count:Number(t.consultants_count??t.consultantsCount??0)}}),I=P(()=>{var t,e;return((e=(t=j.value)==null?void 0:t.meta)==null?void 0:e.total)??0}),F=P(()=>{var t,e,u,d;return[{title:i("invoicesPage.widgets.clients"),value:E.value.clients_count??0,icon:"tabler-user",color:"primary"},{title:i("invoicesPage.widgets.invoices"),value:I.value??0,icon:"tabler-file-invoice",color:"info"},{title:i("invoicesPage.widgets.paid"),value:`SAR ${U(((e=(t=E.value)==null?void 0:t.paid)==null?void 0:e.total)??0)}`,icon:"tabler-checks",color:"success"},{title:i("invoicesPage.widgets.unpaid"),value:`SAR ${U(((d=(u=E.value)==null?void 0:u.unpaid)==null?void 0:d.total)??0)}`,icon:"tabler-circle-off",color:"warning"}]}),ie=P(()=>[{title:i("invoicesPage.status.paid"),value:"paid"},{title:i("invoicesPage.status.unpaid"),value:"unpaid"},{title:i("invoicesPage.status.cancelled"),value:"cancelled"}]),oe=P(()=>[{title:i("invoicesPage.table.headers.invoiceNumber"),key:"invoice_number"},{title:i("invoicesPage.table.headers.status"),key:"status",sortable:!1},{title:i("invoicesPage.table.headers.client"),key:"client"},{title:i("invoicesPage.table.headers.total"),key:"total"},{title:i("invoicesPage.table.headers.issuedDate"),key:"issued_at"},{title:i("invoicesPage.table.headers.dueDate"),key:"due_at"},{title:i("invoicesPage.table.headers.actions"),key:"actions",sortable:!1}]),se=P(()=>{var t;return(((t=j.value)==null?void 0:t.data)??[]).map(e=>({id:e.id,invoice_number:e.invoice_number,status:e.status,client_name:e.client_name,client_email:e.client_email,client_phone:e.client_phone,consultant_name:e.consultant_name,total:Number(e.total),issued_at:e.issued_at,due_at:e.due_at}))}),X=t=>{const e=String(t||"").toLowerCase();return e==="paid"?{variant:"success",icon:"tabler-check"}:e==="unpaid"?{variant:"warning",icon:"tabler-circle-off"}:e==="cancelled"?{variant:"secondary",icon:"tabler-ban"}:{variant:"secondary",icon:"tabler-help"}},ne=async t=>{await ve(`/v1/invoices/${t}`,{method:"DELETE"});const e=$.value.findIndex(u=>u===t);e!==-1&&$.value.splice(e,1),Q()};return(t,e)=>{const u=de,d=ce,h=ue,R=he("RouterLink"),y=re;return z(),O("section",null,[l(fe,{modelValue:S.value,"onUpdate:modelValue":e[7]||(e[7]=a=>S.value=a),location:"end",temporary:"",scrim:!1,width:"360",class:"invoice-filter-drawer",color:"background"},{default:o(()=>[l(G,{flat:""},{default:o(()=>[l(_e,null,{default:o(()=>[m(s(r(i)("invoicesPage.filters.title")),1)]),_:1}),l(J),l(x,{icon:"",variant:"text",onClick:e[0]||(e[0]=a=>S.value=!1)},{default:o(()=>[l(p,{icon:"tabler-x"})]),_:1})]),_:1}),l(B),l(ke,{class:"pa-4 d-flex flex-column gap-4 invoice-filter-sheet",elevation:"0"},{default:o(()=>[n("div",null,[n("span",Le,s(r(i)("invoicesPage.filters.searchLabel")),1),l(u,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=a=>w.value=a),placeholder:r(i)("invoicesPage.filters.searchPlaceholder"),density:"compact"},null,8,["modelValue","placeholder"])]),n("div",null,[n("span",Ue,s(r(i)("invoicesPage.filters.statusLabel")),1),l(d,{modelValue:k.value,"onUpdate:modelValue":e[2]||(e[2]=a=>k.value=a),items:ie.value,placeholder:r(i)("invoicesPage.filters.statusPlaceholder"),clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items","placeholder"])]),n("div",null,[n("span",Ie,s(r(i)("invoicesPage.filters.issuedRangeLabel")),1),l(h,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=a=>T.value=a),config:{mode:"range",dateFormat:"Y-m-d"},placeholder:r(i)("invoicesPage.filters.issuedRangePlaceholder")},null,8,["modelValue","placeholder"])]),n("div",null,[n("span",Fe,s(r(i)("invoicesPage.filters.totalRangeLabel")),1),n("div",Re,[l(u,{modelValue:C.value,"onUpdate:modelValue":e[4]||(e[4]=a=>C.value=a),type:"number",placeholder:r(i)("invoicesPage.filters.minTotalPlaceholder"),density:"compact"},null,8,["modelValue","placeholder"]),l(u,{modelValue:D.value,"onUpdate:modelValue":e[5]||(e[5]=a=>D.value=a),type:"number",placeholder:r(i)("invoicesPage.filters.maxTotalPlaceholder"),density:"compact"},null,8,["modelValue","placeholder"])])]),l(B,{class:"my-2"}),n("div",ze,[l(x,{variant:"outlined",color:"secondary",onClick:H},{default:o(()=>[l(p,{icon:"tabler-refresh",class:"me-1"}),m(" "+s(r(i)("invoicesPage.filters.reset")),1)]),_:1}),l(x,{class:"invoice-filter-btn",variant:"text","prepend-icon":"tabler-filter",onClick:e[6]||(e[6]=a=>S.value=!1)},{default:o(()=>[m(s(r(i)("invoicesPage.filters.applyAndClose")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue"]),l(Y,{class:"mb-6"},{default:o(()=>[l(Te,{class:"px-3"},{default:o(()=>[l(Ce,null,{default:o(()=>[(z(!0),O(W,null,ye(F.value,(a,_)=>(z(),O(W,{key:_},[l(De,{cols:"12",sm:"6",md:"3",class:"px-6"},{default:o(()=>[n("div",{class:xe(["d-flex justify-space-between align-center",t.$vuetify.display.xs?_!==F.value.length-1?"border-b pb-4":"":t.$vuetify.display.sm&&_<F.value.length/2?"border-b pb-4":""])},[n("div",Be,[n("h4",je,s(a.value),1),n("span",Ee,s(a.title),1)]),l(M,{color:a.color,variant:"tonal",rounded:"",size:"42"},{default:o(()=>[l(p,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])],2)]),_:2},1024),(t.$vuetify.display.mdAndUp?_!==F.value.length-1:t.$vuetify.display.smAndUp&&_%2===0)?(z(),Ve(B,{key:0,vertical:"",inset:"",length:"60"})):Pe("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),l(Y,{id:"invoice-list"},{default:o(()=>[l(G,{flat:"",density:"comfortable",class:"px-4"},{default:o(()=>[n("div",Oe,[n("div",Me,[n("span",null,s(r(i)("invoicesPage.table.show")),1),l(d,{"model-value":v.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"5.5rem"},"onUpdate:modelValue":e[8]||(e[8]=a=>v.value=parseInt(a,10))},null,8,["model-value"])]),n("span",qe,s(r(i)("invoicesPage.table.totalLabel",{count:I.value})),1)]),l(J),l(x,{class:"invoice-filter-btn",variant:"text","prepend-icon":"tabler-filter",onClick:e[9]||(e[9]=a=>S.value=!0)},{default:o(()=>[m(s(r(i)("invoicesPage.filters.title")),1)]),_:1})]),_:1}),l(B),l(Se,{"model-value":$.value,"onUpdate:modelValue":e[11]||(e[11]=a=>$.value=a),"items-per-page":v.value,"onUpdate:itemsPerPage":e[12]||(e[12]=a=>v.value=a),page:f.value,"onUpdate:page":e[13]||(e[13]=a=>f.value=a),"show-select":"","items-length":I.value,headers:oe.value,items:se.value,"item-value":"id",class:"text-no-wrap","onUpdate:options":te},{"no-data":o(()=>[n("div",He,[l(p,{icon:"tabler-file-invoice",size:"40",class:"mb-2"}),n("div",Qe,s(r(i)("invoicesPage.table.noDataTitle")),1),n("div",Xe,s(r(i)("invoicesPage.table.noDataHint")),1),l(x,{variant:"outlined",color:"secondary",onClick:H},{default:o(()=>[l(p,{icon:"tabler-refresh",class:"me-1"}),m(" "+s(r(i)("invoicesPage.filters.resetFilters")),1)]),_:1})])]),"item.invoice_number":o(({item:a})=>[l(R,{to:{name:"apps-invoice-preview-id",params:{id:a.id}}},{default:o(()=>[m(s(a.invoice_number),1)]),_:2},1032,["to"])]),"item.status":o(({item:a})=>[l(Ae,null,{activator:o(({props:_})=>[l(M,we({size:28},_,{color:X(a.status).variant,variant:"tonal"}),{default:o(()=>[l(p,{size:16,icon:X(a.status).icon},null,8,["icon"])]),_:2},1040,["color"])]),default:o(()=>[n("p",Ye,s(r(i)("invoicesPage.tooltip.status"))+": "+s(le(a.status)),1),n("p",Ge,s(r(i)("invoicesPage.tooltip.total"))+": SAR "+s(U(a.total)),1),n("p",Je,s(r(i)("invoicesPage.tooltip.dueDate"))+": "+s(a.due_at),1)]),_:2},1024)]),"item.client":o(({item:a})=>[n("div",Ke,[l(M,{size:"34",color:"primary",variant:"tonal",class:"me-3"},{default:o(()=>[n("span",null,s(ae(a.client_name)),1)]),_:2},1024),n("div",We,[n("span",Ze,s(a.client_name),1),n("span",et,s(a.client_email),1),n("span",tt,s(a.client_phone),1)])])]),"item.total":o(({item:a})=>[m("SAR "+s(U(a.total)),1)]),"item.issued_at":o(({item:a})=>[m(s(a.issued_at),1)]),"item.due_at":o(({item:a})=>[m(s(a.due_at),1)]),"item.actions":o(({item:a})=>[l(x,{icon:"",variant:"text",color:"medium-emphasis"},{default:o(()=>[l(p,{icon:"tabler-dots-vertical"}),l(Ne,{activator:"parent"},{default:o(()=>[l($e,null,{default:o(()=>[l(Z,{to:{name:"apps-invoice-preview-id",params:{id:a.id}}},{prepend:o(()=>[l(p,{icon:"tabler-eye"})]),default:o(()=>[l(ee,null,{default:o(()=>[m(s(r(i)("invoicesPage.actions.view")),1)]),_:1})]),_:2},1032,["to"]),l(Z,{onClick:_=>ne(a.id)},{prepend:o(()=>[l(p,{icon:"tabler-trash"})]),default:o(()=>[l(ee,null,{default:o(()=>[m(s(r(i)("invoicesPage.actions.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:o(()=>[l(y,{page:f.value,"onUpdate:page":e[10]||(e[10]=a=>f.value=a),"items-per-page":v.value,"total-items":I.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["model-value","items-per-page","page","items-length","headers","items"])]),_:1})])}}};export{Kt as default};

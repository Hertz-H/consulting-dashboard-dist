import{_ as he}from"./TablePagination-DpWfT477.js";import{_ as ke}from"./AppSelect-CFPl_1Hi.js";import{_ as Ce}from"./AppTextField-COk9xKX0.js";import{u as Se}from"./useApi-CM-u9C21.js";import{c as Te}from"./createUrl-g3-_zHjx.js";import{$ as Ie}from"./api-CqwGmpgL.js";import{V as Re}from"./VNavigationDrawer-CAH00YaA.js";import{V as j,b as Ae}from"./VCard-DA3WH8Yk.js";import{V as oe,a as Ne}from"./VToolbar-KYBSPYsJ.js";import{V as se}from"./VSpacer-C386geoq.js";import{r as c,aX as Ue,w as Pe,O as d,c as g,b as a,e as o,a as Be,o as v,s as _,a2 as F,a9 as x,d as n,F as M,h as ie,f as O,k as Fe,v as $e,t as m,aP as De,aQ as Le}from"./index-D_BsgN_d.js";import{V as $}from"./VDivider-B9RRXbEE.js";import{V as ze}from"./VSheet-Chqu0LdH.js";import{V as Ee}from"./VCardText-BreTWY-m.js";import{V as je,a as Me}from"./VRow-dG5tZQ8o.js";import{V as Q}from"./VAvatar-DiDwKfKQ.js";import{V as Oe}from"./VDataTableServer-D7S2xQGo.js";import{V as Qe}from"./VMenu-C9ItgqI2.js";import{V as qe,a as Xe,b as Ge}from"./VList-C0cyJi1v.js";import{V as He}from"./VRating-CpF7JaMP.js";import{V as Je}from"./VImg-ht9GXiJm.js";import"./VPagination-NfpXM_oY.js";import"./VLabel-BirfzyCz.js";import"./VSelect-CcUYZ5wP.js";import"./VTextField-BRzklgAv.js";/* empty css                   */import"./VCounter-rHo2n1dF.js";import"./VField-DMdiEKws.js";import"./form-BPS662GX.js";import"./easing-Bybner-F.js";import"./VInput-C1dHExZP.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-xOo4n4OT.js";import"./VOverlay-_8fyux18.js";import"./delay-BE6crMdg.js";import"./lazy-Yg9_h87Z.js";import"./scopeId-D0MMzVks.js";import"./VCheckboxBtn-Bbs9tfyd.js";import"./VSelectionControl-BcJaXfWY.js";import"./VChip-BTQY4HnE.js";import"./VSlideGroup-CQSza4gX.js";import"./index-CvOPxmL5.js";import"./ssrBoot-5EezpzzY.js";/* empty css              */import"./VDataTable-Cufjzu96.js";import"./VTable-Dk3u47PW.js";import"./filter-vR_hWUC6.js";const Ke={key:0},We={class:"d-flex gap-2"},Ye={class:"d-flex justify-space-between mt-2"},Ze={class:"d-flex flex-column"},et={class:"text-h4"},tt={class:"text-body-1 text-capitalize"},lt={class:"d-flex gap-4 align-center flex-wrap"},at={class:"d-flex align-center gap-2"},nt={class:"text-medium-emphasis text-body-2"},ot={class:"d-flex flex-column"},st={class:"font-weight-medium"},it={class:"text-medium-emphasis"},ut={class:"text-medium-emphasis"},rt={class:"text-medium-emphasis"},mt={class:"d-flex align-center"},dt={key:1},ct={class:"d-flex flex-column"},pt={class:"font-weight-medium"},vt={class:"text-medium-emphasis"},ft={class:"text-medium-emphasis"},bt={class:"d-flex align-center"},yt={class:"d-flex flex-column"},gt={class:"font-weight-medium"},_t={class:"text-medium-emphasis"},xt={class:"text-medium-emphasis"},Vt={class:"d-flex align-center gap-1"},wt={class:"text-caption text-medium-emphasis"},ht={class:"d-flex flex-column"},kt={class:"text-body-2"},Ct={class:"text-medium-emphasis"},St={class:"text-body-2"},Tt={key:1},wl={__name:"index",async setup(It){let U,q;const V=c(""),w=c(null),h=c(null),k=c(null),C=c(null),S=c(null),T=c(null),I=c(null),P=c([]),R=c(!1),f=c(10),b=c(1),D=c(),L=c(),ue=l=>{var e,s;D.value=(e=l.sortBy[0])==null?void 0:e.key,L.value=(s=l.sortBy[0])==null?void 0:s.order,f.value=l.itemsPerPage,b.value=l.page},X=l=>l?l.split(" ").map(e=>e[0]).join("").toUpperCase():"?",re=l=>Number(l??0).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}),me=(l,e=90)=>l?l.length<=e?l:l.slice(0,e)+"…":"",de=()=>{V.value="",w.value=null,h.value=null,k.value=null,C.value=null,S.value=null,T.value=null,I.value=null,b.value=1},{data:z,execute:G}=([U,q]=Ue(()=>Se(Te("/v1/reviews",{query:{search:V,rating:w,consultant:h,client:k,status:C,type:S,min_price:T,max_price:I,itemsPerPage:f,page:b,sortBy:D,orderBy:L}}))),U=await U,q(),U);Pe([V,w,h,k,C,S,T,I,f,b,D,L],()=>{G()});const y=d(()=>{var l;return((l=z.value)==null?void 0:l.data)??[]}),A=d(()=>{var l;return((l=z.value)==null?void 0:l.stats)??{}}),E=d(()=>y.value.map((l,e)=>{var p,t,r,H,J,K,W,Y,Z,ee,te,le,ae,ne;const s=l.consultant||((p=l.consultation)==null?void 0:p.handled_by)||{},u=l.client||((t=l.consultation)==null?void 0:t.created_by)||{},i=l.consultation||{};return{id:l.id??i.id??e+1,rating:l.rating,reviewText:l.review,consultantId:s.id,consultantName:s.name,consultantLogo:s.logo,consultantEmail:(r=s.user)==null?void 0:r.email,consultantPhone:(H=s.user)==null?void 0:H.phone,clientId:u.id,clientName:u.name,clientEmail:(J=u.user)==null?void 0:J.email,clientPhone:(K=u.user)==null?void 0:K.phone,consultationId:i.id,consultationNumber:i.consultation_number,consultationSubject:i.subject,consultationStatus:((Y=(W=i.status)==null?void 0:W.title)==null?void 0:Y.ar)||((ee=(Z=i.status)==null?void 0:Z.title)==null?void 0:ee.en)||null,consultationType:((le=(te=i.type)==null?void 0:te.name)==null?void 0:le.ar)||((ne=(ae=i.type)==null?void 0:ae.name)==null?void 0:ne.en)||null,appointmentMethod:i.oppointment_method,appointmentDate:i.oppointment_date,appointmentTime:i.oppointment_time,price:Number(i.price??0)}})),N=d(()=>{var l,e;return A.value.reviews_count??((e=(l=z.value)==null?void 0:l.meta)==null?void 0:e.total)??y.value.length??0}),ce=d(()=>Number(A.value.average_rating??0)),pe=d(()=>Number(A.value.consultants_count??0)),ve=d(()=>Number(A.value.clients_count??0));d(()=>A.value.rating_distribution??{});const B=d(()=>[{title:"Average Rating",value:N.value?`${ce.value.toFixed(1)} / 5`:"–",icon:"tabler-star",color:"warning"},{title:"Total Reviews",value:N.value,icon:"tabler-message-2",color:"primary"},{title:"Consultants Reviewed",value:pe.value,icon:"tabler-user-star",color:"info"},{title:"Clients Reviewed",value:ve.value,icon:"tabler-users",color:"success"}]),fe=d(()=>{const l=new Set(y.value.map(e=>e.rating).filter(Boolean));return Array.from(l).sort((e,s)=>e-s).map(e=>({title:`${e} Stars`,value:e}))}),be=d(()=>{const l=new Set(y.value.map(e=>{var s,u,i;return((s=e.consultant)==null?void 0:s.name)??((i=(u=e.consultation)==null?void 0:u.handled_by)==null?void 0:i.name)}).filter(Boolean));return Array.from(l).map(e=>({title:e,value:e}))}),ye=d(()=>{const l=new Set(y.value.map(e=>{var s,u,i;return((s=e.client)==null?void 0:s.name)??((i=(u=e.consultation)==null?void 0:u.created_by)==null?void 0:i.name)}).filter(Boolean));return Array.from(l).map(e=>({title:e,value:e}))}),ge=d(()=>{const l=new Set(y.value.map(e=>{var s,u,i,p,t,r;return((i=(u=(s=e.consultation)==null?void 0:s.status)==null?void 0:u.title)==null?void 0:i.ar)||((r=(t=(p=e.consultation)==null?void 0:p.status)==null?void 0:t.title)==null?void 0:r.en)}).filter(Boolean));return Array.from(l).map(e=>({title:e,value:e}))}),_e=d(()=>{const l=new Set(y.value.map(e=>{var s,u,i,p,t,r;return((i=(u=(s=e.consultation)==null?void 0:s.type)==null?void 0:u.name)==null?void 0:i.ar)||((r=(t=(p=e.consultation)==null?void 0:p.type)==null?void 0:t.name)==null?void 0:r.en)}).filter(Boolean));return Array.from(l).map(e=>({title:e,value:e}))}),xe=[{title:"Consultation",key:"consultation"},{title:"Consultant",key:"consultant"},{title:"Client",key:"client"},{title:"Rating",key:"rating"},{title:"Price (SAR)",key:"price"},{title:"Appointment",key:"appointment"},{title:"Review",key:"reviewText"},{title:"Actions",key:"actions",sortable:!1}],Ve=async l=>{await Ie(`/v1/reviews/${l}`,{method:"DELETE"});const e=P.value.findIndex(s=>s===l);e!==-1&&P.value.splice(e,1),G()},we=d(()=>l=>[{title:"View Consultation",value:"view-consultation",prependIcon:"tabler-eye",to:{name:"apps-consultation-preview-id",params:{id:l.consultationId}}},{title:"View Consultant",value:"view-consultant",prependIcon:"tabler-user",to:{name:"apps-consultant-profile-id",params:{id:l.consultantId}}},{title:"View Client",value:"view-client",prependIcon:"tabler-user-circle",to:{name:"apps-client-profile-id",params:{id:l.clientId}}}]);return(l,e)=>{const s=Ce,u=ke,i=Be("IconBtn"),p=he;return E.value&&E.value.length?(v(),g("section",Ke,[a(Re,{modelValue:R.value,"onUpdate:modelValue":e[10]||(e[10]=t=>R.value=t),location:"end",temporary:"",scrim:!1,width:"360",class:"review-filter-drawer",color:"background"},{default:o(()=>[a(oe,{flat:""},{default:o(()=>[a(Ne,null,{default:o(()=>e[17]||(e[17]=[_("Filters")])),_:1,__:[17]}),a(se),a(F,{icon:"",variant:"text",onClick:e[0]||(e[0]=t=>R.value=!1)},{default:o(()=>[a(x,{icon:"tabler-x"})]),_:1})]),_:1}),a($),a(ze,{class:"pa-4 d-flex flex-column gap-4 review-filter-sheet",elevation:"0"},{default:o(()=>[n("div",null,[e[18]||(e[18]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Search ",-1)),a(s,{modelValue:V.value,"onUpdate:modelValue":e[1]||(e[1]=t=>V.value=t),placeholder:"Search in consultant, client, or subject",density:"compact"},null,8,["modelValue"])]),n("div",null,[e[19]||(e[19]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Rating ",-1)),a(u,{modelValue:w.value,"onUpdate:modelValue":e[2]||(e[2]=t=>w.value=t),items:fe.value,placeholder:"Filter by rating",clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items"])]),n("div",null,[e[20]||(e[20]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Consultant ",-1)),a(u,{modelValue:h.value,"onUpdate:modelValue":e[3]||(e[3]=t=>h.value=t),items:be.value,placeholder:"Filter by consultant",clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items"])]),n("div",null,[e[21]||(e[21]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Client ",-1)),a(u,{modelValue:k.value,"onUpdate:modelValue":e[4]||(e[4]=t=>k.value=t),items:ye.value,placeholder:"Filter by client",clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items"])]),n("div",null,[e[22]||(e[22]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Consultation Status ",-1)),a(u,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=t=>C.value=t),items:ge.value,placeholder:"Filter by status",clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items"])]),n("div",null,[e[23]||(e[23]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Consultation Type ",-1)),a(u,{modelValue:S.value,"onUpdate:modelValue":e[6]||(e[6]=t=>S.value=t),items:_e.value,placeholder:"Filter by type",clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items"])]),n("div",null,[e[24]||(e[24]=n("span",{class:"text-body-2 font-weight-medium mb-1 d-block"}," Price range (SAR) ",-1)),n("div",We,[a(s,{modelValue:T.value,"onUpdate:modelValue":e[7]||(e[7]=t=>T.value=t),type:"number",placeholder:"Min",density:"compact"},null,8,["modelValue"]),a(s,{modelValue:I.value,"onUpdate:modelValue":e[8]||(e[8]=t=>I.value=t),type:"number",placeholder:"Max",density:"compact"},null,8,["modelValue"])])]),a($,{class:"my-2"}),n("div",Ye,[a(F,{variant:"outlined",color:"secondary",onClick:de},{default:o(()=>[a(x,{icon:"tabler-refresh",class:"me-1"}),e[25]||(e[25]=_(" Reset "))]),_:1,__:[25]}),a(F,{class:"review-filter-btn",variant:"text","prepend-icon":"tabler-filter",onClick:e[9]||(e[9]=t=>R.value=!1)},{default:o(()=>e[26]||(e[26]=[_(" Apply & Close ")])),_:1,__:[26]})])]),_:1})]),_:1},8,["modelValue"]),a(j,{class:"mb-6"},{default:o(()=>[a(Ee,{class:"px-3"},{default:o(()=>[a(je,null,{default:o(()=>[(v(!0),g(M,null,ie(B.value,(t,r)=>(v(),g(M,{key:r},[a(Me,{cols:"12",sm:"6",md:"3",class:"px-6"},{default:o(()=>[n("div",{class:$e(["d-flex justify-space-between align-center",l.$vuetify.display.xs?r!==B.value.length-1?"border-b pb-4":"":l.$vuetify.display.sm&&r<B.value.length/2?"border-b pb-4":""])},[n("div",Ze,[n("h4",et,m(t.value),1),n("span",tt,m(t.title),1)]),a(Q,{color:t.color,variant:"tonal",rounded:"",size:"42"},{default:o(()=>[a(x,{icon:t.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])],2)]),_:2},1024),(l.$vuetify.display.mdAndUp?r!==B.value.length-1:l.$vuetify.display.smAndUp&&r%2===0)?(v(),O($,{key:0,vertical:"",inset:"",length:"60"})):Fe("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),a(j,{id:"review-list"},{default:o(()=>[a(oe,{flat:"",density:"comfortable",class:"px-4"},{default:o(()=>[n("div",lt,[n("div",at,[e[27]||(e[27]=n("span",null,"Show",-1)),a(u,{"model-value":f.value,items:[{value:10,title:"10"},{value:25,title:"25"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"5.5rem"},"onUpdate:modelValue":e[11]||(e[11]=t=>f.value=parseInt(t,10))},null,8,["model-value"])]),n("span",nt," Total: "+m(N.value)+" reviews ",1)]),a(se),a(F,{class:"review-filter-btn",variant:"text","prepend-icon":"tabler-filter",onClick:e[12]||(e[12]=t=>R.value=!0)},{default:o(()=>e[28]||(e[28]=[_(" Filters ")])),_:1,__:[28]})]),_:1}),a($),a(Oe,{"model-value":P.value,"onUpdate:modelValue":e[14]||(e[14]=t=>P.value=t),"items-per-page":f.value,"onUpdate:itemsPerPage":e[15]||(e[15]=t=>f.value=t),page:b.value,"onUpdate:page":e[16]||(e[16]=t=>b.value=t),"items-length":N.value,headers:xe,items:E.value,"item-value":"id",class:"text-no-wrap review-table","onUpdate:options":ue},{"item.consultation":o(({item:t})=>[n("div",ot,[n("span",st,m(t.consultationSubject||"—"),1),n("small",it," #"+m(t.consultationNumber||t.consultationId),1),n("small",ut,m(t.consultationType),1),n("small",rt," Status: "+m(t.consultationStatus||"—"),1)])]),"item.consultant":o(({item:t})=>[n("div",mt,[a(Q,{size:"34",class:"me-3",color:t.consultantLogo?void 0:"primary",variant:t.consultantLogo?"flat":"tonal"},{default:o(()=>[t.consultantLogo?(v(),O(Je,{key:0,src:t.consultantLogo},null,8,["src"])):(v(),g("span",dt,m(X(t.consultantName)),1))]),_:2},1032,["color","variant"]),n("div",ct,[n("span",pt,m(t.consultantName),1),n("small",vt,m(t.consultantEmail),1),n("small",ft,m(t.consultantPhone),1)])])]),"item.client":o(({item:t})=>[n("div",bt,[a(Q,{size:"34",color:"secondary",variant:"tonal",class:"me-3"},{default:o(()=>[n("span",null,m(X(t.clientName)),1)]),_:2},1024),n("div",yt,[n("span",gt,m(t.clientName),1),n("small",_t,m(t.clientEmail),1),n("small",xt,m(t.clientPhone),1)])])]),"item.rating":o(({item:t})=>[n("div",Vt,[a(He,{"model-value":t.rating,color:"warning",density:"compact","half-increments":"false",size:"18",readonly:""},null,8,["model-value"]),n("span",wt," ("+m(t.rating)+") ",1)])]),"item.price":o(({item:t})=>[_(" SAR "+m(re(t.price)),1)]),"item.appointment":o(({item:t})=>[n("div",ht,[n("span",kt,m(t.appointmentMethod||"—"),1),n("small",Ct,m(t.appointmentDate)+" "+m(t.appointmentTime),1)])]),"item.reviewText":o(({item:t})=>[n("span",St,m(me(t.reviewText,70)),1)]),"item.actions":o(({item:t})=>[a(i,{onClick:r=>Ve(t.id)},{default:o(()=>[a(x,{icon:"tabler-trash"})]),_:2},1032,["onClick"]),a(Qe,null,{activator:o(({props:r})=>[a(i,De(Le(r)),{default:o(()=>[a(x,{icon:"tabler-dots-vertical"})]),_:2},1040)]),default:o(()=>[a(qe,null,{default:o(()=>[(v(!0),g(M,null,ie(we.value(t),r=>(v(),O(Xe,{key:r.value,to:r.to,link:""},{default:o(()=>[a(Ge,{class:"d-flex align-center gap-2"},{default:o(()=>[a(x,{icon:r.prependIcon,size:"18"},null,8,["icon"]),n("span",null,m(r.title),1)]),_:2},1024)]),_:2},1032,["to"]))),128))]),_:2},1024)]),_:2},1024)]),bottom:o(()=>[a(p,{page:b.value,"onUpdate:page":e[13]||(e[13]=t=>b.value=t),"items-per-page":f.value,"total-items":N.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["model-value","items-per-page","page","items-length","items"])]),_:1})])):(v(),g("section",Tt,[a(j,null,{default:o(()=>[a(Ae,null,{default:o(()=>e[29]||(e[29]=[_("No Reviews Found")])),_:1,__:[29]})]),_:1})]))}}};export{wl as default};

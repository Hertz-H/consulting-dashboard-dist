import{_ as Ie}from"./TablePagination-DdJ4S-xc.js";import{_ as Fe}from"./AppDateTimePicker-BI87Kwdz.js";import{_ as je}from"./AppSelect-D-PeoRGq.js";import{_ as Ee}from"./AppTextField-CKxKpX8V.js";import{u as Me}from"./useApi-Ct-6W-lY.js";import{c as qe}from"./createUrl-B9xqrxdL.js";import{$ as F}from"./api-DE6DUsJ_.js";import{V as Re}from"./VSnackbar-CsMSBaJm.js";import{V as He}from"./VNavigationDrawer-BwFW6XH2.js";import{V as j,b as Ke,d as Qe}from"./VCard-C_4VJn-8.js";import{V as Xe}from"./VDialog-DA4ukpgS.js";import{V as de,a as Ye}from"./VToolbar-CfXpctrD.js";import{V as Z}from"./VSpacer-DvIbVmMT.js";import{al as Ge,r as u,w as ee,O as y,aX as Je,c as T,b as l,e as s,a as me,o as b,s as d,t as n,l as i,a2 as x,a9 as f,d as r,F as E,h as pe,f as M,k as fe,v as ve}from"./index-DQmZf-Xj.js";import{V as $}from"./VDivider-DdQ5ZGaf.js";import{V as We}from"./VSheet-CL5gvgxe.js";import{V as te}from"./VCardText-BRVadkC6.js";import{V as ge,a as be}from"./VRow-BFdw40-L.js";import{V as _e}from"./VAvatar-BSaP2aJ4.js";import{V as Ze}from"./VDataTableServer-DG8ATzzf.js";import{V as et}from"./VMenu-D3tTBXxA.js";import{V as tt,a as q,b as R}from"./VList-C6mR20Ba.js";import{V as ye}from"./VChip-MuDwaTxO.js";import"./VPagination-DB0ECNje.js";import"./VField-D4ioAJ5d.js";import"./VLabel-DGDnQGXC.js";import"./form-Bo4elXah.js";import"./easing-Bybner-F.js";import"./VInput-DjvCNQyc.js";import"./VImg-DOcWVjej.js";import"./VSelect-Bhu0lvyB.js";import"./VTextField-CLE0haGg.js";/* empty css                   */import"./VCounter-n4uRWdM2.js";import"./forwardRefs-C-GTDzx5.js";import"./dialog-transition-kbiQFXWj.js";import"./VOverlay-dQ2rZt_z.js";import"./delay-DgqARyzl.js";import"./lazy-BUeLM-Y3.js";import"./scopeId-A6e6jMOB.js";import"./VCheckboxBtn-BwzO9Ng7.js";import"./VSelectionControl-C8NAjBaP.js";import"./index-CvOPxmL5.js";import"./ssrBoot-DAbQuRUP.js";/* empty css              */import"./VDataTable-CPT08wR-.js";import"./VTable-Dgj5a2wM.js";import"./filter-CUzo-_Rb.js";import"./VSlideGroup-D5H4D9Mv.js";const lt={class:"text-body-2 font-weight-medium mb-1 d-block"},at={class:"text-body-2 font-weight-medium mb-1 d-block"},st={class:"text-body-2 font-weight-medium mb-1 d-block"},ot={class:"text-body-2 font-weight-medium mb-1 d-block"},nt={class:"d-flex justify-space-between mt-2"},rt={class:"d-flex flex-column"},it={class:"text-h4"},ut={class:"text-body-1 text-capitalize"},ct={class:"d-flex flex-column"},dt={class:"text-h4"},mt={class:"text-body-1 text-capitalize"},pt={class:"d-flex gap-4 align-center flex-wrap"},ft={class:"d-flex align-center gap-2"},vt={class:"text-medium-emphasis text-body-2"},gt={class:"d-flex align-center gap-x-4"},bt={class:"d-flex flex-column"},_t={class:"text-base"},yt={class:"text-sm"},xt={class:"text-body-1 text-high-emphasis text-capitalize"},Vt={class:"text-body-2"},_l={__name:"index",async setup(ht){let A,le;const{t:o}=Ge(),V=u(""),h=u(null),w=u(null),ae=u([]),P=u(!1),k=u(null),se=u(void 0),oe=u(void 0),v=u(10),g=u(1),H=u("id"),K=u("desc"),S=u(!1),z=u(null),Q=u(""),C=u(!1),X=u(!1),ne=u(""),re=u("success"),ie=(e,t="success")=>{ne.value=e,re.value=t,X.value=!0},U=e=>{if(e)return e instanceof Date?e.toISOString().slice(0,10):String(e).slice(0,10)},xe=(e,t,c)=>{if(!e){t.value=void 0,c.value=void 0;return}if(Array.isArray(e)){const[p,O]=e;t.value=U(p),c.value=U(O);return}if(typeof e=="object"){t.value=U(e.start),c.value=U(e.end);return}if(typeof e=="string"){const p=e.split(" to ");t.value=U(p[0]||""),c.value=U(p[1]||"");return}t.value=void 0,c.value=void 0},Ve=e=>{var c;g.value=e.page,v.value=e.itemsPerPage;const t=(c=e.sortBy)==null?void 0:c[0];H.value=(t==null?void 0:t.key)||"id",K.value=(t==null?void 0:t.order)||"desc"};ee(k,e=>xe(e,se,oe),{immediate:!0});const he=()=>{V.value="",h.value=null,w.value=null,k.value=null,g.value=1};ee([V,h,w,k,v],()=>{g.value=1});const we=y(()=>[{title:o("roles.admin"),value:"admin"},{title:o("roles.client"),value:"client"},{title:o("roles.consultant"),value:"consultant"},{title:o("roles.consultantOffice"),value:"consultant-office"}]),ke=y(()=>[{title:o("status.active"),value:1},{title:o("status.pending"),value:0},{title:o("status.inactive"),value:2}]),{data:Y,execute:D}=([A,le]=Je(()=>Me(qe("/v1/users",{query:{q:V,status:w,role:h||void 0,created_from:se,created_to:oe,page:g,per_page:v,sortBy:H,orderBy:K}}))),A=await A,le(),A);ee([V,h,w,k,v,g,H,K],()=>{D()});const Ue=y(()=>{var e;return((e=Y.value)==null?void 0:e.data)??[]}),G=y(()=>{var e,t;return((t=(e=Y.value)==null?void 0:e.meta)==null?void 0:t.total)??0}),_=y(()=>{var t;const e=(t=Y.value)==null?void 0:t.summary;return{total:(e==null?void 0:e.total)??0,active:(e==null?void 0:e.active)??0,pending:(e==null?void 0:e.pending)??0,inactive:(e==null?void 0:e.inactive)??0,admins:(e==null?void 0:e.admins)??0,consultants:(e==null?void 0:e.consultants)??0,consultant_offices:(e==null?void 0:e.consultant_offices)??0,clients:(e==null?void 0:e.clients)??0}}),N=y(()=>[{title:o("usersPage.widgets.totalUsers"),value:_.value.total,icon:"tabler-users",color:"primary"},{title:o("usersPage.widgets.active"),value:_.value.active,icon:"tabler-user-check",color:"success"},{title:o("usersPage.widgets.pending"),value:_.value.pending,icon:"tabler-user-search",color:"warning"},{title:o("usersPage.widgets.inactive"),value:_.value.inactive,icon:"tabler-user-off",color:"secondary"}]),L=y(()=>[{title:o("usersPage.widgets.consultants"),value:_.value.consultants,icon:"tabler-user-check",color:"success"},{title:o("usersPage.widgets.consultantOffices"),value:_.value.consultant_offices,icon:"tabler-building-community",color:"info"},{title:o("usersPage.widgets.clients"),value:_.value.clients,icon:"tabler-user",color:"warning"},{title:o("usersPage.widgets.admins"),value:_.value.admins,icon:"tabler-crown",color:"primary"}]),Pe={admin:"roles.admin",client:"roles.client",consultant:"roles.consultant","consultant-office":"roles.consultantOffice"},Ce=e=>{const t=(e||"").trim();return t==="admin"?{color:"primary",icon:"tabler-crown"}:t==="client"?{color:"warning",icon:"tabler-user"}:t==="consultant"?{color:"success",icon:"tabler-user-check"}:t==="consultant-office"?{color:"info",icon:"tabler-building-community"}:{color:"secondary",icon:"tabler-user"}},J=e=>{if(e==null||e==="")return 2;if(typeof e=="number")return[0,1,2].includes(e)?e:2;const t=String(e).trim();if(t==="0"||t==="1"||t==="2")return Number(t);const c=t.toLowerCase();return c==="active"?1:c==="pending"?0:2},De={1:"status.active",0:"status.pending",2:"status.inactive"},Te=e=>{const t=J(e);return t===0?"warning":t===1?"success":t===2?"secondary":"primary"},$e=e=>{const t=J(e);return o(De[t]??"status.inactive")},Ae=y(()=>[{title:o("common.users"),key:"user"},{title:o("common.phone"),key:"phone"},{title:o("common.roles"),key:"roles",sortable:!1},{title:o("common.status"),key:"status",sortable:!1},{title:o("common.actions"),key:"actions",sortable:!1}]),ue=u(!1),Se=async e=>{await F("/apps/users",{method:"POST",body:e}),D()},ze=async e=>{await F(`/v1/users/${e}/deactivate`,{method:"PATCH"}),D()},Ne=async e=>{await F(`/v1/users/${e}/activate`,{method:"PATCH"}),D()},Le=e=>{z.value=(e==null?void 0:e.id)??null,Q.value=(e==null?void 0:e.name)||(e==null?void 0:e.email)||`#${(e==null?void 0:e.id)??""}`,S.value=!0},W=()=>{S.value=!1,z.value=null,Q.value=""},Oe=e=>{var B,I;const t=((B=e==null?void 0:e.response)==null?void 0:B.data)??((I=e==null?void 0:e.response)==null?void 0:I._data)??(e==null?void 0:e.data)??(e==null?void 0:e._data)??null,c=(t==null?void 0:t.message)||(t==null?void 0:t.error)||(t==null?void 0:t.msg)||(e==null?void 0:e.message)||"",p=t!=null&&t.errors?Object.values(t.errors).flat().filter(Boolean):[];return((p.length?p.join(`
`):"")||c||(typeof t=="string"?t:"")||o("common.error")||"Request failed").trim()},Be=async()=>{if(!(!z.value||C.value)){C.value=!0;try{await F(`/v1/users/${z.value}`,{method:"DELETE"}),ie(o("common.deletedSuccessfully"),"success"),W(),await D()}catch(e){ie(Oe(e),"error"),W(),console.error("Failed to delete user",e)}finally{C.value=!1}}};return(e,t)=>{const c=Ee,p=je,O=Fe,ce=me("RouterLink"),B=Ie,I=me("AddNewUserDrawer");return b(),T("section",null,[l(Re,{modelValue:X.value,"onUpdate:modelValue":t[0]||(t[0]=a=>X.value=a),color:re.value,location:"top right",position:"fixed",timeout:"2500",class:"users-toast"},{default:s(()=>[d(n(ne.value),1)]),_:1},8,["modelValue","color"]),l(He,{modelValue:P.value,"onUpdate:modelValue":t[7]||(t[7]=a=>P.value=a),location:"end",temporary:"",scrim:!1,width:"360",class:"users-filter-drawer",color:"background"},{default:s(()=>[l(de,{flat:""},{default:s(()=>[l(Ye,null,{default:s(()=>[d(n(i(o)("common.filters")),1)]),_:1}),l(Z),l(x,{icon:"",variant:"text",onClick:t[1]||(t[1]=a=>P.value=!1)},{default:s(()=>[l(f,{icon:"tabler-x"})]),_:1})]),_:1}),l($),l(We,{class:"pa-4 d-flex flex-column gap-4 users-filter-sheet",elevation:"0"},{default:s(()=>[r("div",null,[r("span",lt,n(i(o)("common.search")),1),l(c,{modelValue:V.value,"onUpdate:modelValue":t[2]||(t[2]=a=>V.value=a),placeholder:i(o)("usersPage.filters.searchPlaceholder"),density:"compact"},null,8,["modelValue","placeholder"])]),r("div",null,[r("span",at,n(i(o)("common.status")),1),l(p,{modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=a=>w.value=a),items:ke.value,placeholder:i(o)("usersPage.filters.statusPlaceholder"),clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items","placeholder"])]),r("div",null,[r("span",st,n(i(o)("common.roles")),1),l(p,{modelValue:h.value,"onUpdate:modelValue":t[4]||(t[4]=a=>h.value=a),items:we.value,placeholder:i(o)("usersPage.filters.rolePlaceholder"),clearable:"","clear-icon":"tabler-x",density:"compact"},null,8,["modelValue","items","placeholder"])]),r("div",null,[r("span",ot,n(i(o)("usersPage.filters.createdRangeLabel")),1),l(O,{modelValue:k.value,"onUpdate:modelValue":t[5]||(t[5]=a=>k.value=a),config:{mode:"range",dateFormat:"Y-m-d"},placeholder:i(o)("usersPage.filters.createdRangePlaceholder")},null,8,["modelValue","placeholder"])]),l($,{class:"my-2"}),r("div",nt,[l(x,{variant:"outlined",color:"secondary",onClick:he},{default:s(()=>[l(f,{icon:"tabler-refresh",class:"me-1"}),d(" "+n(i(o)("common.reset")),1)]),_:1}),l(x,{class:"users-filter-btn",variant:"text","prepend-icon":"tabler-filter",onClick:t[6]||(t[6]=a=>P.value=!1)},{default:s(()=>[d(n(i(o)("common.applyAndClose")),1)]),_:1})])]),_:1})]),_:1},8,["modelValue"]),l(j,{class:"mb-6"},{default:s(()=>[l(te,{class:"px-3"},{default:s(()=>[l(ge,null,{default:s(()=>[(b(!0),T(E,null,pe(N.value,(a,m)=>(b(),T(E,{key:"top-"+m},[l(be,{cols:"12",sm:"6",md:"3",class:"px-6"},{default:s(()=>[r("div",{class:ve(["d-flex justify-space-between align-center",e.$vuetify.display.xs?m!==N.value.length-1?"border-b pb-4":"":e.$vuetify.display.sm&&m<N.value.length/2?"border-b pb-4":""])},[r("div",rt,[r("h4",it,n(a.value),1),r("span",ut,n(a.title),1)]),l(_e,{color:a.color,variant:"tonal",rounded:"",size:"42"},{default:s(()=>[l(f,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])],2)]),_:2},1024),(e.$vuetify.display.mdAndUp?m!==N.value.length-1:e.$vuetify.display.smAndUp&&m%2===0)?(b(),M($,{key:0,vertical:"",inset:"",length:"60"})):fe("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),l(j,{class:"mb-6"},{default:s(()=>[l(te,{class:"px-3"},{default:s(()=>[l(ge,null,{default:s(()=>[(b(!0),T(E,null,pe(L.value,(a,m)=>(b(),T(E,{key:"bottom-"+m},[l(be,{cols:"12",sm:"6",md:"3",class:"px-6"},{default:s(()=>[r("div",{class:ve(["d-flex justify-space-between align-center",e.$vuetify.display.xs?m!==L.value.length-1?"border-b pb-4":"":e.$vuetify.display.sm&&m<L.value.length/2?"border-b pb-4":""])},[r("div",ct,[r("h4",dt,n(a.value),1),r("span",mt,n(a.title),1)]),l(_e,{color:a.color,variant:"tonal",rounded:"",size:"42"},{default:s(()=>[l(f,{icon:a.icon,size:"26"},null,8,["icon"])]),_:2},1032,["color"])],2)]),_:2},1024),e.$vuetify.display.mdAndUp&&m!==L.value.length-1?(b(),M($,{key:0,vertical:"",inset:"",length:"60"})):fe("",!0)],64))),128))]),_:1})]),_:1})]),_:1}),l(j,{id:"users-list"},{default:s(()=>[l(de,{flat:"",density:"comfortable",class:"px-4"},{default:s(()=>[r("div",pt,[r("div",ft,[r("span",null,n(i(o)("common.show")),1),l(p,{"model-value":v.value,items:[{value:10,title:"10"},{value:20,title:"20"},{value:50,title:"50"},{value:100,title:"100"}],style:{"inline-size":"5.5rem"},"onUpdate:modelValue":t[8]||(t[8]=a=>v.value=parseInt(a,10))},null,8,["model-value"])]),r("span",vt,n(i(o)("usersPage.table.totalUsersLabel",{count:G.value})),1)]),l(Z),l(x,{class:"users-filter-btn",variant:"text","prepend-icon":"tabler-filter",onClick:t[9]||(t[9]=a=>P.value=!0)},{default:s(()=>[d(n(i(o)("common.filters")),1)]),_:1})]),_:1}),l($),l(Ze,{"model-value":ae.value,"onUpdate:modelValue":t[11]||(t[11]=a=>ae.value=a),"items-per-page":v.value,"onUpdate:itemsPerPage":t[12]||(t[12]=a=>v.value=a),page:g.value,"onUpdate:page":t[13]||(t[13]=a=>g.value=a),items:Ue.value,"items-length":G.value,headers:Ae.value,class:"text-no-wrap","onUpdate:options":Ve},{"item.user":s(({item:a})=>[r("div",gt,[r("div",bt,[r("h6",_t,[l(ce,{to:{name:"apps-user-view-id",params:{id:a.id}},class:"font-weight-medium text-link"},{default:s(()=>[d(n(a.name),1)]),_:2},1032,["to"])]),r("div",yt,n(a.email),1)])])]),"item.phone":s(({item:a})=>[r("div",xt,n(a.phone),1)]),"item.roles":s(({item:a})=>[l(ye,{color:Ce(a.roles).color,size:"small",label:"",class:"text-capitalize"},{default:s(()=>[d(n(i(o)(Pe[a.roles]??"roles.client")),1)]),_:2},1032,["color"])]),"item.status":s(({item:a})=>[l(ye,{color:Te(a.status),size:"small",label:"",class:"text-capitalize"},{default:s(()=>[d(n($e(a.status)),1)]),_:2},1032,["color"])]),"item.actions":s(({item:a})=>[l(x,{icon:"",variant:"text",color:"medium-emphasis"},{default:s(()=>[l(f,{icon:"tabler-dots-vertical"}),l(et,{activator:"parent"},{default:s(()=>[l(tt,null,{default:s(()=>[l(q,{to:{name:"apps-user-view-id",params:{id:a.id}}},{prepend:s(()=>[l(f,{icon:"tabler-pencil"})]),default:s(()=>[l(R,null,{default:s(()=>[d(n(i(o)("common.edit")),1)]),_:1})]),_:2},1032,["to"]),Number(J(a.status))===1?(b(),M(q,{key:0,onClick:m=>ze(a.id)},{prepend:s(()=>[l(f,{icon:"tabler-eye"})]),default:s(()=>[l(R,null,{default:s(()=>[d(n(i(o)("common.suspend")),1)]),_:1})]),_:2},1032,["onClick"])):(b(),M(q,{key:1,onClick:m=>Ne(a.id)},{prepend:s(()=>[l(f,{icon:"tabler-eye"})]),default:s(()=>[l(R,null,{default:s(()=>[d(n(i(o)("common.activate")),1)]),_:1})]),_:2},1032,["onClick"])),l(q,{onClick:m=>Le(a)},{prepend:s(()=>[l(f,{icon:"tabler-trash"})]),default:s(()=>[l(R,null,{default:s(()=>[d(n(i(o)("common.delete")),1)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024)]),_:2},1024)]),bottom:s(()=>[l(B,{page:g.value,"onUpdate:page":t[10]||(t[10]=a=>g.value=a),"items-per-page":v.value,"total-items":G.value},null,8,["page","items-per-page","total-items"])]),_:1},8,["model-value","items-per-page","page","items","items-length","headers"])]),_:1}),l(Xe,{modelValue:S.value,"onUpdate:modelValue":t[14]||(t[14]=a=>S.value=a),"max-width":"460"},{default:s(()=>[l(j,null,{default:s(()=>[l(Ke,{class:"d-flex align-center gap-2"},{default:s(()=>[l(f,{icon:"tabler-alert-triangle",color:"warning"}),r("span",null,n(i(o)("common.confirm")),1)]),_:1}),l(te,null,{default:s(()=>[r("div",Vt,n(i(o)("common.confirmDelete",{name:Q.value})),1)]),_:1}),l(Qe,{class:"px-4 pb-4"},{default:s(()=>[l(Z),l(x,{variant:"text",color:"secondary",disabled:C.value,onClick:W},{default:s(()=>[d(n(i(o)("common.cancel")),1)]),_:1},8,["disabled"]),l(x,{color:"error",variant:"flat",loading:C.value,onClick:Be},{default:s(()=>[d(n(i(o)("common.delete")),1)]),_:1},8,["loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"]),l(I,{"is-drawer-open":ue.value,"onUpdate:isDrawerOpen":t[15]||(t[15]=a=>ue.value=a),onUserData:Se},null,8,["is-drawer-open"])])}}};export{_l as default};

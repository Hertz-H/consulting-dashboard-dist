import{_ as M}from"./AppTextField-6Zt2y8Qn.js";import{al as O,u as z,i as D,O as S,r as p,c as j,o as q,b as s,e as r,d as a,l,s as h,a9 as I,t as u,k as G,aF as H,a2 as E,au as J}from"./index-DLyiUI4T.js";import{_ as K}from"./sc-Cf-H3ghh.js";import{u as L}from"./useApi-B07hdb0V.js";import{_ as Q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as P,a as b}from"./VRow-BThkmVdP.js";import{V as W}from"./VCard-Bp3Y2g69.js";import{V as X}from"./VCardText-CNPcEnqc.js";import{V as Y}from"./VForm-Vmkhs5rN.js";import{V as Z}from"./VContainer-DF-lMkWu.js";import{V as ee}from"./VSnackbar-TawvNeit.js";import"./VLabel-Bj0ZLaaG.js";import"./VTextField-D_VDXh9N.js";/* empty css                   */import"./VCounter-DSUdNhJf.js";import"./VImg-W922IUCz.js";import"./VField-DJvLbBqg.js";import"./form-4FzIkTDC.js";import"./easing-Bybner-F.js";import"./VInput-CZKa1bvG.js";import"./forwardRefs-C-GTDzx5.js";/* empty css              */import"./VAvatar-GwUQM--D.js";import"./VOverlay-BpuXFPpY.js";import"./delay-CJQMA8o3.js";import"./lazy-D7mfu-eq.js";import"./scopeId-BqXwnYFS.js";const te={class:"admin-reset-page",dir:"rtl"},se={class:"hero-visual"},ae={class:"hero-image"},oe={class:"img-container"},re=["alt"],le={class:"float-card float-top float-top--mini"},ie={class:"mini-head"},ne={class:"mini-badge"},ue={class:"mini-state"},de={class:"mini-desc"},ce={class:"text-truncate"},me={key:0,class:"mt-2"},pe={class:"hero-copy"},fe={class:"hero-title"},ve={class:"hero-subtitle"},_e={__name:"reset-password",setup(he){const{t}=O(),T=z(),B=D(),g=S(()=>String(T.query.identifier||sessionStorage.getItem("reset_identifier")||"")),y=S(()=>String(T.query.token||sessionStorage.getItem("reset_token")||"")),x=p(!1),V=p(!1),k=p(!1),C=p(!1),F=p(""),N=p("success"),_=(d,e="success")=>{F.value=d,N.value=e,C.value=!0},w=p(""),i=p({password:"",password_confirmation:""});S(()=>{var c,o;const d=(c=i.value.password)==null?void 0:c.trim(),e=(o=i.value.password_confirmation)==null?void 0:o.trim();return!!g.value&&!!y.value&&!!d&&!!e&&d===e});const U=async()=>{var d,e,c,o,R,$;if(!g.value){_(t("auth.reset.missing_identifier"),"error");return}if(!y.value){_(t("auth.reset.missing_token"),"error");return}if(!((d=i.value.password)!=null&&d.trim())||!((e=i.value.password_confirmation)!=null&&e.trim())){_(t("auth.reset.validation_required"),"error");return}if(i.value.password.trim()!==i.value.password_confirmation.trim()){_(t("auth.reset.password_mismatch"),"error");return}x.value=!0,w.value="";try{const m={identifier:g.value,token:y.value,password:i.value.password.trim(),password_confirmation:i.value.password_confirmation.trim()},{data:n,error:f}=await L("/v1/reset-password").post(m).json();if(f!=null&&f.value){const A=((o=(c=f.value)==null?void 0:c.data)==null?void 0:o.message)||t("auth.reset.failed")||"فشل إعادة تعيين كلمة المرور";throw new Error(A)}const v=(n==null?void 0:n.value)||{};v!=null&&v.message&&(w.value=v.message),_(t("auth.reset.success"),"success"),await J(()=>B.replace({name:"login"}))}catch(m){const n=(R=m==null?void 0:m.response)==null?void 0:R.data;let f=(n==null?void 0:n.message)||(m==null?void 0:m.message)||w.value||t("auth.reset.failed")||"فشل إعادة تعيين كلمة المرور";const v=n!=null&&n.errors?($=Object.values(n.errors).flat())==null?void 0:$[0]:null;v&&(f=v),_(f,"error")}finally{x.value=!1}};return(d,e)=>{const c=M;return q(),j("section",te,[s(Z,{class:"content",fluid:""},{default:r(()=>[s(P,{class:"align-center",style:{"min-height":"100vh"}},{default:r(()=>[s(b,{cols:"12",md:"6",class:"d-flex justify-center"},{default:r(()=>[a("div",se,[a("div",ae,[e[7]||(e[7]=a("div",{class:"shimmer"},null,-1)),e[8]||(e[8]=a("div",{class:"visual-bg"},null,-1)),a("div",oe,[a("img",{src:K,alt:l(t)("auth.reset.title")||"Reset Password"},null,8,re)]),a("div",le,[a("div",ie,[a("div",ne,[s(I,{icon:"tabler-lock",size:"16",class:"me-1"}),h(" "+u(l(t)("auth.reset.title")||"إعادة تعيين كلمة المرور"),1)]),a("div",ue,[e[6]||(e[6]=a("span",{class:"mini-dot"},null,-1)),h(" "+u(l(t)("auth.reset.secure")||"آمن"),1)])]),a("div",de,[a("div",ce,[h(u(l(t)("auth.reset.for")||"لـ")+": ",1),a("b",null,u(g.value),1)]),w.value?(q(),j("div",me,u(w.value),1)):G("",!0)])])])])]),_:1}),s(b,{cols:"12",md:"6"},{default:r(()=>[a("div",pe,[a("h1",fe,u(l(t)("auth.reset.heading")||"تعيين كلمة مرور جديدة"),1),a("p",ve,u(l(t)("auth.reset.subtitle")||"أدخل كلمة مرور جديدة ثم أكدها لإتمام العملية."),1),s(W,{class:"reset-card",elevation:"0"},{default:r(()=>[s(X,null,{default:r(()=>[s(Y,{onSubmit:H(U,["prevent"])},{default:r(()=>[s(P,null,{default:r(()=>[s(b,{cols:"12"},{default:r(()=>[s(c,{modelValue:i.value.password,"onUpdate:modelValue":e[0]||(e[0]=o=>i.value.password=o),type:V.value?"text":"password",label:l(t)("auth.reset.password")||"كلمة المرور الجديدة",placeholder:l(t)("auth.reset.password_placeholder")||"••••••••","prepend-inner-icon":"tabler-lock","append-inner-icon":V.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[1]||(e[1]=o=>V.value=!V.value),autocomplete:"new-password"},null,8,["modelValue","type","label","placeholder","append-inner-icon"])]),_:1}),s(b,{cols:"12"},{default:r(()=>[s(c,{modelValue:i.value.password_confirmation,"onUpdate:modelValue":e[2]||(e[2]=o=>i.value.password_confirmation=o),type:k.value?"text":"password",label:l(t)("auth.reset.confirm")||"تأكيد كلمة المرور",placeholder:l(t)("auth.reset.confirm_placeholder")||"••••••••","prepend-inner-icon":"tabler-lock-check","append-inner-icon":k.value?"tabler-eye-off":"tabler-eye","onClick:appendInner":e[3]||(e[3]=o=>k.value=!k.value),autocomplete:"new-password"},null,8,["modelValue","type","label","placeholder","append-inner-icon"])]),_:1}),s(b,{cols:"12",class:"d-flex gap-3 mt-2"},{default:r(()=>[s(E,{type:"submit",loading:x.value,color:"primary",class:"btn-primary"},{default:r(()=>[s(I,{icon:"tabler-check",class:"me-2"}),h(" "+u(l(t)("auth.reset.submit")||"تحديث كلمة المرور"),1)]),_:1},8,["loading"]),s(E,{variant:"outlined",class:"btn-outline",onClick:e[4]||(e[4]=o=>l(B).replace({name:"login"}))},{default:r(()=>[s(I,{icon:"tabler-arrow-back",class:"me-2"}),h(" "+u(l(t)("auth.reset.back_login")||"رجوع لتسجيل الدخول"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),s(ee,{modelValue:C.value,"onUpdate:modelValue":e[5]||(e[5]=o=>C.value=o),color:N.value,location:"bottom end",timeout:"3500"},{default:r(()=>[h(u(F.value),1)]),_:1},8,["modelValue","color"])])}}},He=Q(_e,[["__scopeId","data-v-c1187787"]]);export{He as default};

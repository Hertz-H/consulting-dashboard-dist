import{b5 as f}from"./index-_jCPV2aF.js";import{u as C}from"./useApi-BSihX8I_.js";import{c as p}from"./createUrl-DerIJZgq.js";import{$ as o}from"./api-CPmHFLjm.js";const w=f("chat",{state:()=>({contacts:[],chatsContacts:[],profileUser:void 0,activeChat:null,consultationChat:null}),actions:{async fetchChatsAndContacts(t){const{data:a,error:s}=await C(p("/apps/chat/chats-and-contacts",{query:{q:t}}));if(s.value)console.log(s.value);else{const{chatsContacts:e,contacts:c,profileUser:i}=a.value;this.chatsContacts=e,this.contacts=c,this.profileUser=i}},async getChat(t){const a=await o(`/apps/chat/chats/${t}`);this.activeChat=a},async getConsultationChat(t){var e;const{data:a,error:s}=await C(`/v1/consultations/${t}/chat`);if(s.value){console.error("Error fetching consultation chat:",s.value);return}(e=a.value)!=null&&e.data&&(this.consultationChat=a.value.data)},async sendConsultationMessage(t,a){const s=await o(`/v1/consultations/${t}/chat`,{method:"POST",body:{message:a}});return await this.getConsultationChat(t),s},async sendMsg(t){var h,r,u,l,d;const a=(h=this.profileUser)==null?void 0:h.id,s=await o(`apps/chat/chats/${(r=this.activeChat)==null?void 0:r.contact.id}`,{method:"POST",body:{message:t,senderId:a}}),{msg:e,chat:c}=s;if(c!==void 0){const n=this.activeChat;this.chatsContacts.push({...n.contact,chat:{id:c.id,lastMessage:[],unseenMsgs:0,messages:[e]}}),this.activeChat&&(this.activeChat.chat={id:c.id,messages:[e],unseenMsgs:0,userId:(u=this.activeChat)==null?void 0:u.contact.id})}else(d=(l=this.activeChat)==null?void 0:l.chat)==null||d.messages.push(e);const i=this.chatsContacts.find(n=>this.activeChat?n.id===this.activeChat.contact.id:!1);i.chat.lastMessage=e}}});export{w as u};

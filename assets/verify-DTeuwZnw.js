import{_ as z}from"./AppTextField-6Zt2y8Qn.js";import{al as P,u as G,i as H,O as V,r as c,E as J,au as M,b4 as K,c as k,o as x,b as t,e as i,d as o,l,s as n,a9 as N,t as r,k as L,aF as Q,a2 as C,F as U}from"./index-DLyiUI4T.js";import{_ as W}from"./sc-Cf-H3ghh.js";import{u as X}from"./authStore-Czv366bH.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as $,a as h}from"./VRow-BThkmVdP.js";import{V as Z}from"./VCard-Bp3Y2g69.js";import{V as ee}from"./VCardText-CNPcEnqc.js";import{V as te}from"./VForm-Vmkhs5rN.js";import{V as se}from"./VContainer-DF-lMkWu.js";import{V as ae}from"./VSnackbar-TawvNeit.js";import"./VLabel-Bj0ZLaaG.js";import"./VTextField-D_VDXh9N.js";/* empty css                   */import"./VCounter-DSUdNhJf.js";import"./VImg-W922IUCz.js";import"./VField-DJvLbBqg.js";import"./form-4FzIkTDC.js";import"./easing-Bybner-F.js";import"./VInput-CZKa1bvG.js";import"./forwardRefs-C-GTDzx5.js";import"./useApi-B07hdb0V.js";/* empty css              */import"./VAvatar-GwUQM--D.js";import"./VOverlay-BpuXFPpY.js";import"./delay-CJQMA8o3.js";import"./lazy-D7mfu-eq.js";import"./scopeId-BqXwnYFS.js";const oe={class:"admin-verify-page",dir:"rtl"},ie={class:"hero-visual"},le={class:"hero-image"},re={class:"img-container"},ne=["alt"],ce={class:"float-card float-top float-top--mini"},ue={class:"mini-head"},de={class:"mini-badge"},me={class:"mini-state"},fe={class:"mini-desc"},ve={class:"text-truncate"},pe={key:0,class:"mt-2"},_e={class:"hero-copy"},he={class:"hero-title"},ye={class:"hero-subtitle"},I=60,ge={__name:"verify",setup(be){const{t:a}=P(),B=G(),y=H(),E=X(),S=V(()=>String(B.query.channel||sessionStorage.getItem("reset_channel")||"email")),v=V(()=>String(B.query.identifier||sessionStorage.getItem("reset_identifier")||"")),w=c(!1),g=c(!1),T=c(!1),F=c(""),q=c("success"),p=(s,e="success")=>{F.value=s,q.value=e,T.value=!0},d=c(""),b=c({code:""}),j=V(()=>{var e;return(((e=b.value.code)==null?void 0:e.trim())||"").length>=4}),m=c(I),R=V(()=>m.value<=0);let u=null;const D=(s=I)=>{m.value=s,u&&clearInterval(u),u=setInterval(()=>{m.value-=1,m.value<=0&&(m.value=0,clearInterval(u),u=null)},1e3)};J(()=>{D(I),v.value||M(()=>y.replace({name:"login"}))}),K(()=>{u&&clearInterval(u)});const A=async()=>{if(!j.value){p(a("auth.verify.code_required")||"رمز التحقق مطلوب.","error");return}w.value=!0,d.value="";try{const{message:s,data:e}=await E.verifyResetCode({channel:S.value,identifier:v.value,code:b.value.code.trim()});s&&(d.value=s),p(a("auth.verify.verified")||"تم تأكيد الرمز بنجاح.","success");const f=(e==null?void 0:e.token)||(e==null?void 0:e.reset_token)||(e==null?void 0:e.resetToken)||(e==null?void 0:e.otp_token)||(e==null?void 0:e.otpToken)||"";f&&sessionStorage.setItem("reset_token",f),await M(()=>y.replace({name:"reset-password",query:{channel:S.value,identifier:v.value,...f?{token:f}:{}}}))}catch(s){p((s==null?void 0:s.message)||a("auth.verify.failed")||"فشل التحقق، حاول مرة أخرى.","error")}finally{w.value=!1}},O=async()=>{if(R.value){g.value=!0,d.value="";try{const{message:s}=await E.forgotPassword({channel:S.value,identifier:v.value});s&&(d.value=s),p(a("auth.verify.resent")||"تم إرسال رمز جديد.","success"),D(I)}catch(s){p((s==null?void 0:s.message)||a("auth.verify.resend_failed")||"فشل إعادة إرسال الرمز.","error")}finally{g.value=!1}}};return(s,e)=>{const f=z;return x(),k("section",oe,[t(se,{class:"content",fluid:""},{default:i(()=>[t($,{class:"align-center",style:{"min-height":"100vh"}},{default:i(()=>[t(h,{cols:"12",md:"6",class:"d-flex justify-center"},{default:i(()=>[o("div",ie,[o("div",le,[e[5]||(e[5]=o("div",{class:"shimmer"},null,-1)),e[6]||(e[6]=o("div",{class:"visual-bg"},null,-1)),o("div",re,[o("img",{src:W,alt:l(a)("auth.verify.title")||"Verify"},null,8,ne)]),o("div",ce,[o("div",ue,[o("div",de,[t(N,{icon:"tabler-shield-check",size:"16",class:"me-1"}),n(" "+r(l(a)("auth.verify.title")||"تأكيد الرمز"),1)]),o("div",me,[e[4]||(e[4]=o("span",{class:"mini-dot"},null,-1)),n(" "+r(l(a)("auth.verify.secure")||"آمن"),1)])]),o("div",fe,[o("div",ve,[n(r(l(a)("auth.verify.sent_to")||"تم الإرسال إلى")+": ",1),o("b",null,r(v.value),1)]),d.value?(x(),k("div",pe,r(d.value),1)):L("",!0)])])])])]),_:1}),t(h,{cols:"12",md:"6"},{default:i(()=>[o("div",_e,[o("h1",he,r(l(a)("auth.verify.heading")||"أدخل رمز التحقق"),1),o("p",ye,r(l(a)("auth.verify.subtitle")||"تم إرسال رمز إلى بريدك الإلكتروني. أدخله أدناه للمتابعة."),1),t(Z,{class:"verify-card",elevation:"0"},{default:i(()=>[t(ee,null,{default:i(()=>[t(te,{onSubmit:Q(A,["prevent"])},{default:i(()=>[t($,null,{default:i(()=>[t(h,{cols:"12"},{default:i(()=>[t(f,{modelValue:b.value.code,"onUpdate:modelValue":e[0]||(e[0]=_=>b.value.code=_),label:l(a)("auth.verify.code")||"رمز التحقق",placeholder:l(a)("auth.verify.code_placeholder")||"أدخل الرمز","prepend-inner-icon":"tabler-key",inputmode:"numeric",autocomplete:"one-time-code"},null,8,["modelValue","label","placeholder"])]),_:1}),t(h,{cols:"12",class:"d-flex gap-3 mt-2"},{default:i(()=>[t(C,{type:"submit",loading:w.value,color:"primary",class:"btn-primary"},{default:i(()=>[t(N,{icon:"tabler-check",class:"me-2"}),n(" "+r(l(a)("auth.verify.verify")||"تأكيد"),1)]),_:1},8,["loading"]),t(C,{variant:"outlined",class:"btn-outline",disabled:!R.value||g.value,loading:g.value,onClick:O},{default:i(()=>[t(N,{icon:"tabler-refresh",class:"me-2"}),R.value?(x(),k(U,{key:0},[n(r(l(a)("auth.verify.resend")||"إعادة إرسال الرمز"),1)],64)):(x(),k(U,{key:1},[n(r(l(a)("auth.verify.resend_in")||"إعادة الإرسال بعد")+" "+r(m.value)+"s ",1)],64))]),_:1},8,["disabled","loading"])]),_:1}),t(h,{cols:"12",class:"d-flex justify-space-between mt-2"},{default:i(()=>[t(C,{variant:"text",class:"link-btn",onClick:e[1]||(e[1]=_=>l(y).replace({name:"forgot-password"}))},{default:i(()=>[n(r(l(a)("auth.verify.change_identifier")||"تغيير البريد"),1)]),_:1}),t(C,{variant:"text",class:"link-btn",onClick:e[2]||(e[2]=_=>l(y).replace({name:"login"}))},{default:i(()=>[n(r(l(a)("auth.verify.back_login")||"رجوع لتسجيل الدخول"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),t(ae,{modelValue:T.value,"onUpdate:modelValue":e[3]||(e[3]=_=>T.value=_),color:q.value,location:"bottom end",timeout:"3500"},{default:i(()=>[n(r(F.value),1)]),_:1},8,["modelValue","color"])])}}},Qe=Y(ge,[["__scopeId","data-v-b58e6205"]]);export{Qe as default};

import{_ as z}from"./AppTextField-jGANKBQX.js";import{al as P,u as G,i as H,O as V,r as c,E as J,au as D,b4 as K,c as b,o as k,b as e,e as l,d as i,l as o,s as n,a9 as E,t as r,k as L,aF as Q,a2 as x,F as M}from"./index-Df0vDIYO.js";import{_ as W}from"./sc-Cf-H3ghh.js";import{u as X}from"./authStore-DUaivpLC.js";import{_ as Y}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as U,a as _}from"./VRow-C48oP8rF.js";import{V as Z}from"./VCard-CgfAP4z1.js";import{V as ee}from"./VCardText-CB6nWipv.js";import{V as te}from"./VForm-LJs8z4wK.js";import{V as ae}from"./VContainer-CkDeoApE.js";import{V as se}from"./VSnackbar-U_R2qOlN.js";import"./VLabel-X6aAEUPa.js";import"./VTextField-Bk-xicTH.js";/* empty css                   */import"./VCounter-CDNaFmaS.js";import"./VImg-D-iRAKzb.js";import"./VField-uLTC6ZdN.js";import"./form-CH_H7Z9j.js";import"./easing-Bybner-F.js";import"./VInput-DH7V_F8-.js";import"./forwardRefs-C-GTDzx5.js";import"./useApi-CrpjD065.js";/* empty css              */import"./VAvatar-BSK7_YRS.js";import"./VOverlay-CEc4fXoL.js";import"./delay-FQ7L2EsZ.js";import"./lazy-B5EM0j6M.js";import"./scopeId-DhzGCC8_.js";const ie={class:"admin-verify-page",dir:"rtl"},le={class:"hero-visual"},oe={class:"hero-image"},re={class:"img-container"},ne=["alt"],ce={class:"float-card float-top float-top--mini"},ue={class:"mini-head"},de={class:"mini-badge"},me={class:"mini-state"},fe={class:"mini-desc"},ve={class:"text-truncate"},pe={key:0,class:"mt-2"},_e={class:"hero-copy"},he={class:"hero-title"},ye={class:"hero-subtitle"},C=60,ge={__name:"verify-email-v2",setup(Ve){const{t}=P(),N=G(),h=H(),T=X(),w=V(()=>String(N.query.channel||"email")),v=V(()=>String(N.query.identifier||"")),I=c(!1),y=c(!1),S=c(!1),B=c(""),F=c("success"),d=(a,s="success")=>{B.value=a,F.value=s,S.value=!0},m=c(""),g=c({code:""}),$=V(()=>{var s;return(((s=g.value.code)==null?void 0:s.trim())||"").length>=4}),f=c(C),R=V(()=>f.value<=0);let u=null;const q=(a=C)=>{f.value=a,u&&clearInterval(u),u=setInterval(()=>{f.value-=1,f.value<=0&&(f.value=0,clearInterval(u),u=null)},1e3)};J(()=>{q(C),v.value||(d(t("auth.verify.missing_identifier")||"البريد/المعرّف غير موجود.","error"),D(()=>h.replace({name:"login"})))}),K(()=>{u&&clearInterval(u)});const j=async()=>{if(!$.value){d(t("auth.verify.code_required")||"رمز التحقق مطلوب.","error");return}I.value=!0,m.value="";try{const{message:a}=await T.verifyResetCode({channel:w.value,identifier:v.value,code:g.value.code.trim()});a&&(m.value=a),d(t("auth.verify.verified")||"تم تأكيد الرمز بنجاح.","success"),await D(()=>h.replace({name:"admin-reset-password",query:{channel:w.value,identifier:v.value}}))}catch(a){d((a==null?void 0:a.message)||t("auth.verify.failed")||"فشل التحقق، حاول مرة أخرى.","error")}finally{I.value=!1}},A=async()=>{if(R.value){y.value=!0,m.value="";try{const{message:a}=await T.forgotPassword({channel:w.value,identifier:v.value});a&&(m.value=a),d(t("auth.verify.resent")||"تم إرسال رمز جديد.","success"),q(C)}catch(a){d((a==null?void 0:a.message)||t("auth.verify.resend_failed")||"فشل إعادة إرسال الرمز.","error")}finally{y.value=!1}}};return(a,s)=>{const O=z;return k(),b("section",ie,[e(ae,{class:"content",fluid:""},{default:l(()=>[e(U,{class:"align-center",style:{"min-height":"100vh"}},{default:l(()=>[e(_,{cols:"12",md:"6",class:"d-flex justify-center"},{default:l(()=>[i("div",le,[i("div",oe,[s[5]||(s[5]=i("div",{class:"shimmer"},null,-1)),s[6]||(s[6]=i("div",{class:"visual-bg"},null,-1)),i("div",re,[i("img",{src:W,alt:o(t)("auth.verify.title")||"Verify"},null,8,ne)]),i("div",ce,[i("div",ue,[i("div",de,[e(E,{icon:"tabler-shield-check",size:"16",class:"me-1"}),n(" "+r(o(t)("auth.verify.title")||"تأكيد الرمز"),1)]),i("div",me,[s[4]||(s[4]=i("span",{class:"mini-dot"},null,-1)),n(" "+r(o(t)("auth.verify.secure")||"آمن"),1)])]),i("div",fe,[i("div",ve,[n(r(o(t)("auth.verify.sent_to")||"تم الإرسال إلى")+": ",1),i("b",null,r(v.value),1)]),m.value?(k(),b("div",pe,r(m.value),1)):L("",!0)])])])])]),_:1}),e(_,{cols:"12",md:"6"},{default:l(()=>[i("div",_e,[i("h1",he,r(o(t)("auth.verify.heading")||"أدخل رمز التحقق"),1),i("p",ye,r(o(t)("auth.verify.subtitle")||"تم إرسال رمز إلى بريدك الإلكتروني. أدخله أدناه للمتابعة."),1),e(Z,{class:"verify-card",elevation:"0"},{default:l(()=>[e(ee,null,{default:l(()=>[e(te,{onSubmit:Q(j,["prevent"])},{default:l(()=>[e(U,null,{default:l(()=>[e(_,{cols:"12"},{default:l(()=>[e(O,{modelValue:g.value.code,"onUpdate:modelValue":s[0]||(s[0]=p=>g.value.code=p),label:o(t)("auth.verify.code")||"رمز التحقق",placeholder:o(t)("auth.verify.code_placeholder")||"أدخل الرمز","prepend-inner-icon":"tabler-key",inputmode:"numeric",autocomplete:"one-time-code"},null,8,["modelValue","label","placeholder"])]),_:1}),e(_,{cols:"12",class:"d-flex gap-3 mt-2"},{default:l(()=>[e(x,{type:"submit",loading:I.value,color:"primary",class:"btn-primary"},{default:l(()=>[e(E,{icon:"tabler-check",class:"me-2"}),n(" "+r(o(t)("auth.verify.verify")||"تأكيد"),1)]),_:1},8,["loading"]),e(x,{variant:"outlined",class:"btn-outline",disabled:!R.value||y.value,loading:y.value,onClick:A},{default:l(()=>[e(E,{icon:"tabler-refresh",class:"me-2"}),R.value?(k(),b(M,{key:0},[n(r(o(t)("auth.verify.resend")||"إعادة إرسال الرمز"),1)],64)):(k(),b(M,{key:1},[n(r(o(t)("auth.verify.resend_in")||"إعادة الإرسال بعد")+" "+r(f.value)+"s ",1)],64))]),_:1},8,["disabled","loading"])]),_:1}),e(_,{cols:"12",class:"d-flex justify-space-between mt-2"},{default:l(()=>[e(x,{variant:"text",class:"link-btn",onClick:s[1]||(s[1]=p=>o(h).replace({name:"admin-forgot-password"}))},{default:l(()=>[n(r(o(t)("auth.verify.change_identifier")||"تغيير البريد"),1)]),_:1}),e(x,{variant:"text",class:"link-btn",onClick:s[2]||(s[2]=p=>o(h).replace({name:"login"}))},{default:l(()=>[n(r(o(t)("auth.verify.back_login")||"رجوع لتسجيل الدخول"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})])]),_:1})]),_:1})]),_:1}),e(se,{modelValue:S.value,"onUpdate:modelValue":s[3]||(s[3]=p=>S.value=p),color:F.value,location:"bottom end",timeout:"3500"},{default:l(()=>[n(r(B.value),1)]),_:1},8,["modelValue","color"])])}}},Qe=Y(ge,[["__scopeId","data-v-776ca155"]]);export{Qe as default};
